{
    "sourceFile": "FoodMood/src/pages/MenuManager/assets/AddNewMenu(New).jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 2,
            "patches": [
                {
                    "date": 1739605016041,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1739605205078,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,8 +3,12 @@\n import './AddNewMenu.css';\r\n import AddIngredient from './AddIngredient';\r\n import axios from 'axios';\r\n \r\n+{/* \r\n+    1. กดแก้ไขแล้วมันไม่ดึงข้อมูลไปแก้\r\n+*/}\r\n+\r\n const AddNewMenu = ({ data, isEditing, onSave, onClose }) => {\r\n     const [menuName, setMenuName] = useState('');\r\n     const [category_id, setCategory_id] = useState('1');\r\n     const [category, setCategory] = useState('1');\r\n"
                },
                {
                    "date": 1739605329378,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,12 +3,8 @@\n import './AddNewMenu.css';\r\n import AddIngredient from './AddIngredient';\r\n import axios from 'axios';\r\n \r\n-{/* \r\n-    1. กดแก้ไขแล้วมันไม่ดึงข้อมูลไปแก้\r\n-*/}\r\n-\r\n const AddNewMenu = ({ data, isEditing, onSave, onClose }) => {\r\n     const [menuName, setMenuName] = useState('');\r\n     const [category_id, setCategory_id] = useState('1');\r\n     const [category, setCategory] = useState('1');\r\n"
                }
            ],
            "date": 1739605016041,
            "name": "Commit-0",
            "content": "import React, { useState, useEffect } from 'react';\r\nimport { HiPlusCircle } from \"react-icons/hi\";\r\nimport './AddNewMenu.css';\r\nimport AddIngredient from './AddIngredient';\r\nimport axios from 'axios';\r\n\r\nconst AddNewMenu = ({ data, isEditing, onSave, onClose }) => {\r\n    const [menuName, setMenuName] = useState('');\r\n    const [category_id, setCategory_id] = useState('1');\r\n    const [category, setCategory] = useState('1');\r\n    const [sizePrices, setSizePrices] = useState([]);\r\n    const [newSize, setNewSize] = useState('ปกติ');\r\n    const [newSizePrice, setNewSizePrice] = useState('');\r\n    const [imagePreview, setImagePreview] = useState(null);             //show: user input image (ตอนนีัสามารถ show ได้ แต่ยังไม่สามารถเก็บใน database ได้)\r\n\r\n    const [ingredientScreen, setIngredientScreen] = useState(false);    //show: AddIngredient.jsx\r\n\r\n    const [currentSize, setCurrentSize] = useState(null);\r\n    const [price, setPrice] = useState(null);\r\n    const [ingredientMain, setIngredientMain] = useState([\r\n        {\r\n            newIngredient: '',\r\n            newIngredientQty: '',\r\n            unit: 'kg'\r\n        },\r\n    ]);\r\n\r\n    const [ingredientsBySize, setIngredientsBySize] = useState({});\r\n\r\n    const [customOptions, setCustomOptions] = useState([]);\r\n    const [newLabel, setNewLabel] = useState('');\r\n    const [newOption, setNewOption] = useState('');\r\n    const [isOptionVisible, setIsOptionVisible] = useState(false);\r\n\r\n\r\n    const [ingredientOptions, setIngredientOptions] = useState([]);\r\n\r\n    const [categoryList, setCategoryList] = useState([]);\r\n    const [sizeList, setSizeList] = useState([]);\r\n\r\n    // API: Fetch data from database (1.Food category 2.Food size 3.Ingredient)\r\n    useEffect(() => {\r\n        console.log('newSizePrice', newSizePrice);\r\n\r\n        axios.get('http://localhost:5000/api/add_menus/category')\r\n            .then(res => {\r\n                //console.log('category จ้า: ', res.data);\r\n                setCategoryList(res.data); // อัปเดต categoryList\r\n            })\r\n            .catch(err => console.error('Error fetching categories:', err));\r\n\r\n        axios.get('http://localhost:5000/api/add_menus/size')\r\n            .then(res => {\r\n                //console.log('size จ้า: ', res.data);\r\n                setSizeList(res.data); // อัปเดต sizeList\r\n            })\r\n            .catch(err => console.error('Error fetching sizes:', err));\r\n\r\n        axios.get('http://localhost:5000/api/ingredients')\r\n            .then(res => {\r\n                //console.log('ingredient จ้า: ', res.data);\r\n                setIngredientOptions(res.data); // อัปเดต ingredientOptions\r\n            })\r\n            .catch(err => console.error('Error fetching ingredients:', err));\r\n    }, []);\r\n\r\n    // Handle image upload\r\n    const handleImageUpload = (event) => {\r\n        const file = event.target.files[0];\r\n        if (file) {\r\n            const reader = new FileReader();\r\n            reader.onloadend = () => setImagePreview(reader.result);\r\n            reader.readAsDataURL(file);\r\n        }\r\n    };\r\n\r\n    // Add size and price\r\n    const handleAddSizePrice = () => {\r\n        if (newSize && newSizePrice) {\r\n            setSizePrices([{\r\n                size: newSize,\r\n                price: Number(newSizePrice)\r\n            },\r\n            ...sizePrices\r\n            ]);\r\n            setNewSize('');\r\n            setNewSizePrice('');\r\n        }\r\n    };\r\n\r\n    // Show ingredient screen\r\n    const handleIngredientScreen = (size, price, ingredient) => {\r\n        setCurrentSize(size);\r\n        setPrice(price)\r\n        setIngredientMain(ingredient);\r\n\r\n        console.log('ingredient:', ingredient);\r\n        setIngredientScreen(true);\r\n    };\r\n\r\n    // Add ingredient\r\n    const handleAddIngredient = (value) => {\r\n        console.log('value:', value);\r\n        const intoSizePrices = sizePrices.map((item) => {\r\n            if (item.size === value.sizeName) {\r\n                return { ...item, ingredients: value.ingredients };\r\n            }\r\n            return item;\r\n        });\r\n\r\n        console.log('intoSizePrices:', intoSizePrices);\r\n\r\n        setSizePrices(intoSizePrices);\r\n    };\r\n\r\n    // Add custom option\r\n    const handleAddOption = () => {\r\n        if (newLabel && newOption) {\r\n            setCustomOptions([\r\n                ...customOptions,\r\n                { label: newLabel, options: newOption.split(',').map((opt) => opt.trim()) },\r\n            ]);\r\n            setNewLabel('');\r\n            setNewOption('');\r\n            setIsOptionVisible(false);\r\n        }\r\n    };\r\n\r\n    // Default data (use for add new data)\r\n    const [editedData, setEditedData] = useState({\r\n        name: '',\r\n        category_id: null,\r\n        category: null,\r\n        image: null,\r\n        sizePrices: null,\r\n        customOptions: null\r\n    });\r\n\r\n    // API: Fetch \"data\" form database (Data already exist in database)\r\n    useEffect(() => {\r\n        setEditedData({\r\n            name: data.name,\r\n            category_id: data.category_id,\r\n            category: categoryList.find((item) => item._id === category_id)?.name,\r\n            image: imagePreview,\r\n            sizePrices: data.sizePrice,\r\n            customOptions: data.custonOptions\r\n        });\r\n    }, [data]);\r\n\r\n    const handleSave = () => {\r\n        onSave(editedData)\r\n    };\r\n\r\n    return (\r\n        <div className=\"right-box\">\r\n            {!ingredientScreen ? (\r\n                <form onSubmit={(e) => e.preventDefault()}>\r\n                    <div className=\"right-box-header text-center fs-18 fw-5\">เพิ่มเมนูใหม่</div>\r\n\r\n                    <div style={{ marginTop: \"10px\" }}>\r\n                        <label>ชื่อเมนู</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"เช่น ผัดกระเพรา\"\r\n                            value={editedData.name || ''}\r\n                            onChange={(e) => setMenuName(e.target.value)}\r\n                        />\r\n                    </div>\r\n                    <div style={{ marginTop: \"10px\" }}>\r\n                        <label>หมวดหมู่</label>\r\n                        <select\r\n                            className=\"form-select\"\r\n                            value={editedData.category_id || ''}\r\n                            onChange={(e) => setCategory_id(e.target.value)}\r\n                        >\r\n                            {categoryList.map((item, index) => (\r\n                                <option key={index} value={item._id}>{item.name}</option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n                    <div className=\"upload-img\" style={{ marginTop: \"10px\" }} onClick={() => document.getElementById('fileInput').click()}>\r\n                        {imagePreview ? (\r\n                            <img src={imagePreview} alt=\"Uploaded\" style={{ width: '100%', height: '100%', objectFit: 'cover' }} />\r\n                        ) : (\r\n                            <>\r\n                                <HiPlusCircle className=\"fs-60\" />\r\n                                อัปโหลดรูปภาพ\r\n                            </>\r\n                        )}\r\n                    </div>\r\n                    <input\r\n                        id=\"fileInput\"\r\n                        type=\"file\"\r\n                        style={{ display: 'none' }}\r\n                        accept=\"image/*\"\r\n                        onChange={handleImageUpload}\r\n                    />\r\n\r\n                    <div style={{ marginTop: \"10px\" }}>\r\n                        <label>ขนาดและราคา</label>\r\n                        <div>\r\n                            {sizePrices.map((item, index) => (\r\n                                <div\r\n                                    key={index}\r\n                                    className=\"option-box\"\r\n                                    onClick={() => handleIngredientScreen(item.size, item.price, item.ingredients)}\r\n                                >\r\n                                    {item.size} : {item.price} บาท\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n\r\n                        <div className=\"size-price-inputs\" style={{ marginTop: \"10px\" }}>\r\n                            <select\r\n                                className=\"form-select\"\r\n                                value={newSize}\r\n                                onChange={(e) => setNewSize(e.target.value)}\r\n                            >\r\n                                {sizeList.map((item, index) => (\r\n                                    <option key={index} value={item.name}>{item.name}</option>\r\n                                ))}\r\n                            </select>\r\n\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"ราคา\"\r\n                                value={newSizePrice}\r\n                                onChange={(e) => setNewSizePrice(e.target.value)}\r\n                            />\r\n                        </div>\r\n                        <button type=\"button\" className=\"blue-button text-center\" style={{ marginTop: \"10px\" }} onClick={handleAddSizePrice}>\r\n                            เพิ่มขนาดและราคา\r\n                        </button>\r\n                    </div>\r\n\r\n                    <div className='right-box-header' />\r\n\r\n                    {/* Custom Options */}\r\n                    <div className=\"right-box-header\">\r\n                        <div>\r\n                            {customOptions.map((item, index) => (\r\n                                <div key={index} className=\"option-box\">\r\n                                    {item.label} : {item.options.join(', ')}\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                        <div className=\"add-option-label\">\r\n                            <label style={{ marginTop: '8px', marginRight: '6px' }}>ตัวเลือกพิเศษ</label>\r\n                            <button\r\n                                type=\"button\"\r\n                                className=\"circle-plus-btn\"\r\n                                onClick={() => setIsOptionVisible(!isOptionVisible)}\r\n                            >\r\n                                +\r\n                            </button>\r\n                        </div>\r\n\r\n                        {isOptionVisible && (\r\n                            <div className=\"add-option-container\">\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"ชื่อหมวดหมู่ เช่น ระดับความหวาน\"\r\n                                    value={newLabel}\r\n                                    onChange={(e) => setNewLabel(e.target.value)}\r\n                                />\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"ตัวเลือก เช่น 0, 25, 50\"\r\n                                    value={newOption}\r\n                                    onChange={(e) => setNewOption(e.target.value)}\r\n                                />\r\n                                <button type=\"button\" className=\"blue-button\" onClick={handleAddOption}>\r\n                                    เพิ่มตัวเลือก\r\n                                </button>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                    <div className=\"order-action-buttons\">\r\n                        <button type=\"button\" className=\"blue-button\" onClick={() => handleSave(editedData)}>\r\n                            บันทึก\r\n                        </button>\r\n                        <button type=\"button\" className=\"red-button\" onClick={onClose}>\r\n                            ยกเลิก\r\n                        </button>\r\n                    </div>\r\n                </form>\r\n            ) : (\r\n                <AddIngredient\r\n                    currentSize={currentSize}\r\n                    newSizePrice={price}\r\n                    ingredientMain={ingredientMain}\r\n                    ingredientsBySize={ingredientsBySize}\r\n                    ingredientOptions={ingredientOptions}\r\n                    handleAddIngredient={handleAddIngredient}\r\n                    onAddIngredient={(size, ingredient) => {\r\n                        const newIngredients = ingredientsBySize[size] || [];\r\n                        setIngredientsBySize({\r\n                            ...ingredientsBySize,\r\n                            [size]: [...newIngredients, ingredient],\r\n                        });\r\n                    }}\r\n                    onBack={() => setIngredientScreen(false)}\r\n                />\r\n            )}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default AddNewMenu;\r\n"
        }
    ]
}