{
    "sourceFile": "FoodMood/src/pages/MenuManager/MenuManager.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 12,
            "patches": [
                {
                    "date": 1739558701777,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1739558784817,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -86,11 +86,11 @@\n     // Function: Add new data\r\n     const handleAddNewData = () => {\r\n         console.log('เพิ่มรายการอาหารใหม่');\r\n         setDataToEdit({ name: '', category_id: null, category: '', sizePrices: [], customOptions: [] });\r\n-        setIsEditing(false); // เปลี่ยนโหมดเป็น Add\r\n-        setShowEditData(true);\r\n-        setSelectedItem(false);\r\n+        // setIsEditing(false); // เปลี่ยนโหมดเป็น Add\r\n+        // setShowEditData(true);\r\n+        // setSelectedItem(false);\r\n     };\r\n \r\n     // Function: Cancel add or edit data\r\n     const handleCancel = () => {\r\n"
                },
                {
                    "date": 1739558793090,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -86,9 +86,9 @@\n     // Function: Add new data\r\n     const handleAddNewData = () => {\r\n         console.log('เพิ่มรายการอาหารใหม่');\r\n         setDataToEdit({ name: '', category_id: null, category: '', sizePrices: [], customOptions: [] });\r\n-        // setIsEditing(false); // เปลี่ยนโหมดเป็น Add\r\n+        setIsEditing(false); // เปลี่ยนโหมดเป็น Add\r\n         // setShowEditData(true);\r\n         // setSelectedItem(false);\r\n     };\r\n \r\n"
                },
                {
                    "date": 1739558813242,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -87,10 +87,10 @@\n     const handleAddNewData = () => {\r\n         console.log('เพิ่มรายการอาหารใหม่');\r\n         setDataToEdit({ name: '', category_id: null, category: '', sizePrices: [], customOptions: [] });\r\n         setIsEditing(false); // เปลี่ยนโหมดเป็น Add\r\n-        // setShowEditData(true);\r\n-        // setSelectedItem(false);\r\n+        setShowEditData(true);\r\n+        setSelectedItem(false);\r\n     };\r\n \r\n     // Function: Cancel add or edit data\r\n     const handleCancel = () => {\r\n"
                },
                {
                    "date": 1739558834208,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -88,9 +88,9 @@\n         console.log('เพิ่มรายการอาหารใหม่');\r\n         setDataToEdit({ name: '', category_id: null, category: '', sizePrices: [], customOptions: [] });\r\n         setIsEditing(false); // เปลี่ยนโหมดเป็น Add\r\n         setShowEditData(true);\r\n-        setSelectedItem(false);\r\n+        setSelectedItem({ name: '', category_id: null, category: '', sizePrices: [], customOptions: [] });\r\n     };\r\n \r\n     // Function: Cancel add or edit data\r\n     const handleCancel = () => {\r\n"
                },
                {
                    "date": 1739558841335,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -88,9 +88,9 @@\n         console.log('เพิ่มรายการอาหารใหม่');\r\n         setDataToEdit({ name: '', category_id: null, category: '', sizePrices: [], customOptions: [] });\r\n         setIsEditing(false); // เปลี่ยนโหมดเป็น Add\r\n         setShowEditData(true);\r\n-        setSelectedItem({ name: '', category_id: null, category: '', sizePrices: [], customOptions: [] });\r\n+        setSelectedItem(false);\r\n     };\r\n \r\n     // Function: Cancel add or edit data\r\n     const handleCancel = () => {\r\n"
                },
                {
                    "date": 1739558919873,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -88,9 +88,17 @@\n         console.log('เพิ่มรายการอาหารใหม่');\r\n         setDataToEdit({ name: '', category_id: null, category: '', sizePrices: [], customOptions: [] });\r\n         setIsEditing(false); // เปลี่ยนโหมดเป็น Add\r\n         setShowEditData(true);\r\n-        setSelectedItem(false);\r\n+        }\r\n+        setSelectedItem({\r\n+            \"name\": \"\",\r\n+            \"category_id\": \"\",\r\n+            \"category\": \"\",\r\n+            \"image\": \"\",\r\n+            \"sizePrices\": [],\r\n+            \"customOptions\": [],\r\n+        });\r\n     };\r\n \r\n     // Function: Cancel add or edit data\r\n     const handleCancel = () => {\r\n"
                },
                {
                    "date": 1739558972448,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -88,9 +88,8 @@\n         console.log('เพิ่มรายการอาหารใหม่');\r\n         setDataToEdit({ name: '', category_id: null, category: '', sizePrices: [], customOptions: [] });\r\n         setIsEditing(false); // เปลี่ยนโหมดเป็น Add\r\n         setShowEditData(true);\r\n-        }\r\n         setSelectedItem({\r\n             \"name\": \"\",\r\n             \"category_id\": \"\",\r\n             \"category\": \"\",\r\n"
                },
                {
                    "date": 1739559070962,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -77,27 +77,20 @@\n \r\n     // Function: Edit selected data\r\n     const handleEditData = (data) => {\r\n         setDataToEdit(data);\r\n-        setIsEditing(true); // เปลี่ยนโหมดเป็น Edit\r\n+        setIsEditing(\"Edit\"); // เปลี่ยนโหมดเป็น Edit\r\n         setShowEditData(true);\r\n         setShowItemDetail(false);\r\n     };\r\n \r\n     // Function: Add new data\r\n     const handleAddNewData = () => {\r\n         console.log('เพิ่มรายการอาหารใหม่');\r\n         setDataToEdit({ name: '', category_id: null, category: '', sizePrices: [], customOptions: [] });\r\n-        setIsEditing(false); // เปลี่ยนโหมดเป็น Add\r\n+        setIsEditing(\"add\"); // เปลี่ยนโหมดเป็น Add\r\n         setShowEditData(true);\r\n-        setSelectedItem({\r\n-            \"name\": \"\",\r\n-            \"category_id\": \"\",\r\n-            \"category\": \"\",\r\n-            \"image\": \"\",\r\n-            \"sizePrices\": [],\r\n-            \"customOptions\": [],\r\n-        });\r\n+        setSelectedItem();\r\n     };\r\n \r\n     // Function: Cancel add or edit data\r\n     const handleCancel = () => {\r\n"
                },
                {
                    "date": 1739559107066,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -88,9 +88,9 @@\n         console.log('เพิ่มรายการอาหารใหม่');\r\n         setDataToEdit({ name: '', category_id: null, category: '', sizePrices: [], customOptions: [] });\r\n         setIsEditing(\"add\"); // เปลี่ยนโหมดเป็น Add\r\n         setShowEditData(true);\r\n-        setSelectedItem();\r\n+        setSelectedItem({ name: '', category_id: null, category: '', sizePrices: [], customOptions: [] });\r\n     };\r\n \r\n     // Function: Cancel add or edit data\r\n     const handleCancel = () => {\r\n"
                },
                {
                    "date": 1739559253166,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -77,18 +77,18 @@\n \r\n     // Function: Edit selected data\r\n     const handleEditData = (data) => {\r\n         setDataToEdit(data);\r\n-        setIsEditing(\"Edit\"); // เปลี่ยนโหมดเป็น Edit\r\n+        setIsEditing(false); // เปลี่ยนโหมดเป็น Edit\r\n         setShowEditData(true);\r\n         setShowItemDetail(false);\r\n     };\r\n \r\n     // Function: Add new data\r\n     const handleAddNewData = () => {\r\n         console.log('เพิ่มรายการอาหารใหม่');\r\n         setDataToEdit({ name: '', category_id: null, category: '', sizePrices: [], customOptions: [] });\r\n-        setIsEditing(\"add\"); // เปลี่ยนโหมดเป็น Add\r\n+        setIsEditing(false); // เปลี่ยนโหมดเป็น Add\r\n         setShowEditData(true);\r\n         setSelectedItem({ name: '', category_id: null, category: '', sizePrices: [], customOptions: [] });\r\n     };\r\n \r\n"
                },
                {
                    "date": 1739559304149,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -150,9 +150,9 @@\n                     onCancel={handleCancel}\r\n                     onSave={handleSaveData}\r\n                 />\r\n             }\r\n-            {showItemDetail && <MenuItemDetail selectedItem={selectedItem} onEdit={handleEditData} handleClickConfirm={handleClickConfirm} onClose={() => setShowItemDetail(false)} />}\r\n+            {/* {showItemDetail && <MenuItemDetail selectedItem={selectedItem} onEdit={handleEditData} handleClickConfirm={handleClickConfirm} onClose={() => setShowItemDetail(false)} />} */}\r\n         </div>\r\n     );\r\n };\r\n \r\n"
                },
                {
                    "date": 1739559345140,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -88,8 +88,10 @@\n         console.log('เพิ่มรายการอาหารใหม่');\r\n         setDataToEdit({ name: '', category_id: null, category: '', sizePrices: [], customOptions: [] });\r\n         setIsEditing(false); // เปลี่ยนโหมดเป็น Add\r\n         setShowEditData(true);\r\n+        setShowItemDetail(false);\r\n+\r\n         setSelectedItem({ name: '', category_id: null, category: '', sizePrices: [], customOptions: [] });\r\n     };\r\n \r\n     // Function: Cancel add or edit data\r\n@@ -150,9 +152,9 @@\n                     onCancel={handleCancel}\r\n                     onSave={handleSaveData}\r\n                 />\r\n             }\r\n-            {/* {showItemDetail && <MenuItemDetail selectedItem={selectedItem} onEdit={handleEditData} handleClickConfirm={handleClickConfirm} onClose={() => setShowItemDetail(false)} />} */}\r\n+            {showItemDetail && <MenuItemDetail selectedItem={selectedItem} onEdit={handleEditData} handleClickConfirm={handleClickConfirm} onClose={() => setShowItemDetail(false)} />}\r\n         </div>\r\n     );\r\n };\r\n \r\n"
                }
            ],
            "date": 1739558701777,
            "name": "Commit-0",
            "content": "import React, { useEffect, useState } from 'react';\r\nimport './MenuManager.css';\r\nimport AddNewMenu from './assets/AddNewMenu';\r\nimport MenuItemDetail from './assets/MenuItemDetail';\r\nimport MenuList from './assets/MenuList';\r\nimport axios from 'axios';\r\nimport Swal from 'sweetalert2';\r\n\r\n{/*    BUG\r\n    1. เวลาเพิ่มเมนูใหม่เข้าไป มันไม่ยอมแสดงขึ้นให้ ต้อง refresh\r\n    2. เวลาจะแก้ไข special option ไม่ยอมมาด้วย เหมือนต้องใส่ใหม่ไปเลย + ต้องหาวิธีให้มันแก้ไขได้\r\n    3. แทนที่ระบบจะกำหนด form\r\n*/}\r\n\r\nconst MenuManager = () => {\r\n    const [data, setData] = useState([]);       // Collecting datas from API     \r\n    const [category, setCategory] = useState([]); // Collecting category from API\r\n    const [showEditData, setShowEditData] = useState(false);        // show AddNewMenu.jsx\r\n    const [showItemDetail, setShowItemDetail] = useState(false);   // show MenuItemDetail.jsx\r\n\r\n    const [selectedItem, setSelectedItem] = useState(null);         // Select data/item\r\n    const [dataToEdit, setDataToEdit] = useState(null);             // Edit data\r\n    const [isEditing, setIsEditing] = useState(false);              // Add & Edit data (mode toggle)\r\n    const [dataToDelete, setDataToDelete] = useState(null);         // Delete data\r\n\r\n    // API: Fetch data from database\r\n    useEffect(() => {\r\n        axios.get('http://localhost:5000/api/foods')\r\n            .then(res => { setData(res.data) })\r\n            .catch(err => console.error('Error fetching :', err));\r\n            \r\n        axios.get('http://localhost:5000/api/add_menus/category')\r\n            .then(res => { setCategory(res.data) })\r\n            .catch(err => console.error('Error fetching :', err));\r\n    }, []);\r\n\r\n    // API: 1.Edit 2.Add\r\n    const handleSaveData = (updatedData) => {\r\n        if (isEditing) {\r\n            axios.put(`http://localhost:5000/api/foods/${dataToEdit._id}`, updatedData)\r\n                .then(res => {\r\n                    //console.log('แก้ไขรายการอาหารเป็น: ', res.data);\r\n                    setData(data.map(user => (user._id === res.data._id ? res.data : user)));\r\n                })\r\n                .catch(err => console.error('แก้ไขรายการอาหารไม่สำเร็จ:', err));\r\n        } else {\r\n            axios.post('http://localhost:5000/api/foods', updatedData)\r\n                .then(res => { setData(prev => [...prev, res.data]); })\r\n                .catch(err => console.error('เพิ่มรายการอาหารเข้าสู่ database ไม่สำเร็จ:', err));\r\n        }\r\n        setShowEditData(false);\r\n    };\r\n\r\n    // API: 3.Delete\r\n    const handleDeleteIngredient = (data) => {\r\n        //console.log(data._id);\r\n        axios.delete(`http://localhost:5000/api/foods/${data._id}`)\r\n            .then((res) => {\r\n                //console.log('รายการอาหารที่ต้องการลบ:', res.data);\r\n                Swal.fire({\r\n                    title: 'รายการอาหารถูกลบแล้ว!',\r\n                    confirmButtonColor: '#64A2FF',\r\n                    icon: 'success',\r\n                });\r\n                setData((prevData) => prevData.filter((item) => item._id !== data._id));\r\n            })\r\n            .catch((err) => {\r\n                //console.error('เกิดข้อผิดพลาดในการลบรายการอาหาร:', err);\r\n                Swal.fire({\r\n                    title: 'เกิดข้อผิดพลาดในการลบรายการอาหาร',\r\n                    text: 'กรุณาลองใหม่อีกครั้ง',\r\n                    icon: 'error',\r\n                });\r\n            });\r\n    }\r\n\r\n\r\n    // Function: Edit selected data\r\n    const handleEditData = (data) => {\r\n        setDataToEdit(data);\r\n        setIsEditing(true); // เปลี่ยนโหมดเป็น Edit\r\n        setShowEditData(true);\r\n        setShowItemDetail(false);\r\n    };\r\n\r\n    // Function: Add new data\r\n    const handleAddNewData = () => {\r\n        console.log('เพิ่มรายการอาหารใหม่');\r\n        setDataToEdit({ name: '', category_id: null, category: '', sizePrices: [], customOptions: [] });\r\n        setIsEditing(false); // เปลี่ยนโหมดเป็น Add\r\n        setShowEditData(true);\r\n        setSelectedItem(false);\r\n    };\r\n\r\n    // Function: Cancel add or edit data\r\n    const handleCancel = () => {\r\n        setShowEditData(false);\r\n        setShowItemDetail(false);\r\n    };\r\n\r\n    // Function: Select data to show \"MenuItemDetail.jsx\"\r\n    const handleMenuClick = (item) => {\r\n        console.log(item)\r\n        setShowItemDetail(true);\r\n        setSelectedItem(item);\r\n        setShowEditData(false);\r\n    };\r\n\r\n    // Function: Confirm delete window\r\n    const handleClickConfirm = (e) => {\r\n        setDataToDelete(e);\r\n        Swal.fire({\r\n            title: \"แน่ใจใช่ไหม?\",\r\n            text: \"คุณกำลังจะลบ\" + \"\\nชื่ออาหาร: \" + e.name,\r\n            icon: \"warning\",\r\n            showCancelButton: true,\r\n            confirmButtonColor: \"#ff4b4b\",\r\n            cancelButtonColor: \"#B2B2B2\",\r\n            confirmButtonText: 'ยืนยันการลบ',\r\n            cancelButtonText: 'ยกเลิก',\r\n            dangerMode: true,\r\n        }).then((result) => {\r\n            if (result.isConfirmed) {\r\n                handleDeleteIngredient(e);\r\n                setShowEditData(false);\r\n            } else {\r\n                Swal.fire({\r\n                    title: 'ยกเลิกการลบ',\r\n                    confirmButtonColor: '#64A2FF',\r\n                });\r\n            }\r\n        });\r\n    };\r\n\r\n    return (\r\n        <div className='container'>\r\n            <MenuList\r\n                data={data}\r\n                category={category}\r\n                onMenuClick={handleMenuClick}\r\n                onAddNewMenu={handleAddNewData}\r\n                selectedItem={selectedItem}\r\n            />\r\n            {showEditData &&\r\n                <AddNewMenu\r\n                    form={isEditing ? \"Edit\" : \"Add\"}\r\n                    dataToEdit={dataToEdit}\r\n                    data={selectedItem}\r\n                    isEditing={isEditing}\r\n                    onCancel={handleCancel}\r\n                    onSave={handleSaveData}\r\n                />\r\n            }\r\n            {showItemDetail && <MenuItemDetail selectedItem={selectedItem} onEdit={handleEditData} handleClickConfirm={handleClickConfirm} onClose={() => setShowItemDetail(false)} />}\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default MenuManager;\r\n"
        }
    ]
}