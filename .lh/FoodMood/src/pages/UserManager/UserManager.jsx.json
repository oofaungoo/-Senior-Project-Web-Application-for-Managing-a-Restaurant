{
    "sourceFile": "FoodMood/src/pages/UserManager/UserManager.jsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 65,
            "patches": [
                {
                    "date": 1739554088105,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1739554096905,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -141,9 +141,9 @@\n                 <div className=\"search-container\">\r\n                     <input\r\n                         type=\"text\"\r\n                         className=\"search-input\"\r\n-                        placeholder=\"ค้นหาด้วยชื่อ\"\r\n+                        placeholder=\"ค้นหาด้วยชื่อ จ้า\"\r\n                         value={searchQuery}\r\n                         onChange={(e) => setSearchQuery(e.target.value)}\r\n                     />\r\n                     <button className=\"blue-button\" onClick={handleAddNewUser}>เพิ่มผู้ใช้ใหม่</button>\r\n"
                },
                {
                    "date": 1739554257880,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,166 @@\n+import React, { useState, useEffect } from 'react';\r\n+import './UserManager.css';\r\n+import '../IngredientManager/IngredientManager.css';\r\n+import EditUser from './assets/EditUser';\r\n+import UserTable from './assets/UserTable';\r\n+import axios from 'axios';\r\n+import Swal from 'sweetalert2';\r\n+\r\n+const UserManager = () => {\r\n+    const [data, setData] = useState([]);\r\n+    const [searchQuery, setSearchQuery] = useState('');\r\n+    const [showEditUser, setShowEditUser] = useState(false);\r\n+    const [userToEdit, setUserToEdit] = useState(null);\r\n+    const [isEditing, setIsEditing] = useState(false);\r\n+    const [loading, setLoading] = useState(true);\r\n+    const [error, setError] = useState(null);\r\n+    const [roleOptions, setRoleOptions] = useState([]);\r\n+    const [userToDelete, setUserToDelete] = useState(null);\r\n+\r\n+    // Fetch data from the API\r\n+    useEffect(() => {\r\n+        const fetchData = async () => {\r\n+            try {\r\n+                const response = await axios.get('http://localhost:5000/api/users');\r\n+                setData(response.data);\r\n+                \r\n+            } catch (err) {\r\n+                console.error('Failed to fetch users:', err);\r\n+                setError('Failed to load user data.');\r\n+            } finally {\r\n+                setLoading(false);\r\n+            }\r\n+        };\r\n+        fetchData();\r\n+\r\n+        axios.get('http://localhost:5000/api/roles')\r\n+            .then(res => {\r\n+                console.log('role จ้า: ', res.data);\r\n+                setRoleOptions(res.data); \r\n+                \r\n+            })\r\n+            .catch(err => console.error('Error fetching :', err));\r\n+\r\n+    }, []);\r\n+\r\n+    const filteredData = data.filter(item =>\r\n+        (item.id && item.id.includes(searchQuery)) || (item.name && item.name.includes(searchQuery))\r\n+    );\r\n+    \r\n+    const handleEditUser = (user) => {\r\n+        setUserToEdit(user);\r\n+        setIsEditing(true); // Edit user mode\r\n+        setShowEditUser(true);\r\n+    };\r\n+\r\n+    const handleAddNewUser = () => {\r\n+        setUserToEdit({ id: '', name: '', nickname: '', roll: '', status: 'offline', phone: '' });\r\n+        setIsEditing(false); // Add new user mode\r\n+        setShowEditUser(true);\r\n+    };\r\n+\r\n+    const handleSaveUser = (updatedUser) => {\r\n+        if (isEditing) {\r\n+            console.log('แก้ไข user  :', userToEdit._id);\r\n+            axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n+                .then(res => {\r\n+                    console.log('User updated:', res.data);\r\n+                    setData(data.map(user => (user._id === res.data._id ? res.data : user)));\r\n+                })\r\n+                .catch(err => console.error('Failed to update user:', err));\r\n+        } else {\r\n+            console.log('เพิ่ม user:', updatedUser);\r\n+            axios.post('http://localhost:5000/api/users', updatedUser)\r\n+                .then(res => {\r\n+                    console.log('User added:', res.data);\r\n+                    setData([...data, res.data]);\r\n+                })\r\n+                .catch(err => console.error('Failed to add user:', err));\r\n+        }\r\n+        setShowEditUser(false);\r\n+    };\r\n+\r\n+    const handleDeleteUser = (user) => {\r\n+        axios.delete(`http://localhost:5000/api/users/${user._id}`)\r\n+            .then((res) => {\r\n+                Swal.fire({\r\n+                    title: 'ผู้ใช้ดังกล่าวถูกลบแล้ว!',\r\n+                    icon: 'success',\r\n+                    confirmButtonColor: \"#64A2FF\",\r\n+                    confirmButtonText: 'OK',\r\n+                });\r\n+                setData((prevData) => prevData.filter((item) => item._id !== user._id));\r\n+            })\r\n+            .catch((err) => {\r\n+                Swal.fire({\r\n+                    title: 'เกิดข้อผิดพลาดในการลบผู้ใช้ดังกล่าว',\r\n+                    text: 'ลองใหม่อีกครั้ง',\r\n+                    icon: 'error',\r\n+                    confirmButtonColor: \"#64A2FF\",\r\n+                    confirmButtonText: 'OK',\r\n+                });\r\n+            });\r\n+    };\r\n+    \r\n+    const handleClickConfirm = (e) => {\r\n+        setUserToDelete(e);\r\n+        Swal.fire({\r\n+            title: 'แน่ใจใช่ไหม?',\r\n+            text: `คุณกำลังจะลบผู้ใช้\\nชื่อ: ${e.name}\\nตำแหน่ง: ${roleOptions.find(role => role._id === e.role_id)?.role_name}`,\r\n+            icon: 'warning',\r\n+            showCancelButton: true,\r\n+            confirmButtonColor: \"#ff4b4b\",\r\n+            cancelButtonColor: \"#B2B2B2\",\r\n+            confirmButtonText: 'ยืนยันการลบ',\r\n+            cancelButtonText: 'ยกเลิก',\r\n+            dangerMode: true,\r\n+        }).then((result) => {\r\n+            if (result.isConfirmed) {\r\n+                handleDeleteUser(e);\r\n+            } else {\r\n+                Swal.fire({\r\n+                    title: 'ยกเลิกการลบ',\r\n+                    confirmButtonColor: '#64A2FF',\r\n+                });\r\n+            }\r\n+        });\r\n+    };\r\n+    \r\n+\r\n+    if (loading) {\r\n+        return <div className=\"loading\">Loading...</div>;\r\n+    }\r\n+\r\n+    if (error) {\r\n+        return <div className=\"error\">Error: {error}</div>;\r\n+    }\r\n+\r\n+    return (\r\n+        <div className='container'>\r\n+            <div className=\"middle-box\">\r\n+                <div className=\"search-container\">\r\n+                    <input\r\n+                        type=\"text\"\r\n+                        className=\"search-input\"\r\n+                        placeholder=\"ค้นหาด้วยชื่อ จ้า รอบ 2 0.30\"\r\n+                        value={searchQuery}\r\n+                        onChange={(e) => setSearchQuery(e.target.value)}\r\n+                    />\r\n+                    <button className=\"blue-button\" onClick={handleAddNewUser}>เพิ่มผู้ใช้ใหม่</button>\r\n+                </div>\r\n+                <UserTable data={filteredData} roleOptions={roleOptions} onEdit={handleEditUser} handleClickConfirm={handleClickConfirm} />\r\n+            </div>\r\n+            {showEditUser && (\r\n+                <EditUser\r\n+                    isEditing={isEditing}\r\n+                    user={userToEdit}\r\n+                    onClose={() => setShowEditUser(false)}\r\n+                    onSave={handleSaveUser}\r\n+                />\r\n+            )}\r\n+            \r\n+        </div>\r\n+    );\r\n+};\r\n+\r\n+export default UserManager;\r\n"
                },
                {
                    "date": 1739554264107,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -163,170 +163,4 @@\n     );\r\n };\r\n \r\n export default UserManager;\r\n-import React, { useState, useEffect } from 'react';\r\n-import './UserManager.css';\r\n-import '../IngredientManager/IngredientManager.css';\r\n-import EditUser from './assets/EditUser';\r\n-import UserTable from './assets/UserTable';\r\n-import axios from 'axios';\r\n-import Swal from 'sweetalert2';\r\n-\r\n-const UserManager = () => {\r\n-    const [data, setData] = useState([]);\r\n-    const [searchQuery, setSearchQuery] = useState('');\r\n-    const [showEditUser, setShowEditUser] = useState(false);\r\n-    const [userToEdit, setUserToEdit] = useState(null);\r\n-    const [isEditing, setIsEditing] = useState(false);\r\n-    const [loading, setLoading] = useState(true);\r\n-    const [error, setError] = useState(null);\r\n-    const [roleOptions, setRoleOptions] = useState([]);\r\n-    const [userToDelete, setUserToDelete] = useState(null);\r\n-\r\n-    // Fetch data from the API\r\n-    useEffect(() => {\r\n-        const fetchData = async () => {\r\n-            try {\r\n-                const response = await axios.get('http://localhost:5000/api/users');\r\n-                setData(response.data);\r\n-                \r\n-            } catch (err) {\r\n-                console.error('Failed to fetch users:', err);\r\n-                setError('Failed to load user data.');\r\n-            } finally {\r\n-                setLoading(false);\r\n-            }\r\n-        };\r\n-        fetchData();\r\n-\r\n-        axios.get('http://localhost:5000/api/roles')\r\n-            .then(res => {\r\n-                console.log('role จ้า: ', res.data);\r\n-                setRoleOptions(res.data); \r\n-                \r\n-            })\r\n-            .catch(err => console.error('Error fetching :', err));\r\n-\r\n-    }, []);\r\n-\r\n-    const filteredData = data.filter(item =>\r\n-        (item.id && item.id.includes(searchQuery)) || (item.name && item.name.includes(searchQuery))\r\n-    );\r\n-    \r\n-    const handleEditUser = (user) => {\r\n-        setUserToEdit(user);\r\n-        setIsEditing(true); // Edit user mode\r\n-        setShowEditUser(true);\r\n-    };\r\n-\r\n-    const handleAddNewUser = () => {\r\n-        setUserToEdit({ id: '', name: '', nickname: '', roll: '', status: 'offline', phone: '' });\r\n-        setIsEditing(false); // Add new user mode\r\n-        setShowEditUser(true);\r\n-    };\r\n-\r\n-    const handleSaveUser = (updatedUser) => {\r\n-        if (isEditing) {\r\n-            console.log('แก้ไข user  :', userToEdit._id);\r\n-            axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n-                .then(res => {\r\n-                    console.log('User updated:', res.data);\r\n-                    setData(data.map(user => (user._id === res.data._id ? res.data : user)));\r\n-                })\r\n-                .catch(err => console.error('Failed to update user:', err));\r\n-        } else {\r\n-            console.log('เพิ่ม user:', updatedUser);\r\n-            axios.post('http://localhost:5000/api/users', updatedUser)\r\n-                .then(res => {\r\n-                    console.log('User added:', res.data);\r\n-                    setData([...data, res.data]);\r\n-                })\r\n-                .catch(err => console.error('Failed to add user:', err));\r\n-        }\r\n-        setShowEditUser(false);\r\n-    };\r\n-\r\n-    const handleDeleteUser = (user) => {\r\n-        axios.delete(`http://localhost:5000/api/users/${user._id}`)\r\n-            .then((res) => {\r\n-                Swal.fire({\r\n-                    title: 'ผู้ใช้ดังกล่าวถูกลบแล้ว!',\r\n-                    icon: 'success',\r\n-                    confirmButtonColor: \"#64A2FF\",\r\n-                    confirmButtonText: 'OK',\r\n-                });\r\n-                setData((prevData) => prevData.filter((item) => item._id !== user._id));\r\n-            })\r\n-            .catch((err) => {\r\n-                Swal.fire({\r\n-                    title: 'เกิดข้อผิดพลาดในการลบผู้ใช้ดังกล่าว',\r\n-                    text: 'ลองใหม่อีกครั้ง',\r\n-                    icon: 'error',\r\n-                    confirmButtonColor: \"#64A2FF\",\r\n-                    confirmButtonText: 'OK',\r\n-                });\r\n-            });\r\n-    };\r\n-    \r\n-    const handleClickConfirm = (e) => {\r\n-        setUserToDelete(e);\r\n-        Swal.fire({\r\n-            title: 'แน่ใจใช่ไหม?',\r\n-            text: `คุณกำลังจะลบผู้ใช้\\nชื่อ: ${e.name}\\nตำแหน่ง: ${roleOptions.find(role => role._id === e.role_id)?.role_name}`,\r\n-            icon: 'warning',\r\n-            showCancelButton: true,\r\n-            confirmButtonColor: \"#ff4b4b\",\r\n-            cancelButtonColor: \"#B2B2B2\",\r\n-            confirmButtonText: 'ยืนยันการลบ',\r\n-            cancelButtonText: 'ยกเลิก',\r\n-            dangerMode: true,\r\n-        }).then((result) => {\r\n-            if (result.isConfirmed) {\r\n-                handleDeleteUser(e);\r\n-            } else {\r\n-                Swal.fire({\r\n-                    title: 'ยกเลิกการลบ',\r\n-                    confirmButtonColor: '#64A2FF',\r\n-                });\r\n-            }\r\n-        });\r\n-    };\r\n-    \r\n-\r\n-    if (loading) {\r\n-        return <div className=\"loading\">Loading...</div>;\r\n-    }\r\n-\r\n-    if (error) {\r\n-        return <div className=\"error\">Error: {error}</div>;\r\n-    }\r\n-\r\n-    return (\r\n-        <div className='container'>\r\n-            <div className=\"middle-box\">\r\n-                <div className=\"search-container\">\r\n-                    <input\r\n-                        type=\"text\"\r\n-                        className=\"search-input\"\r\n-                        placeholder=\"ค้นหาด้วยชื่อ จ้า\"\r\n-                        value={searchQuery}\r\n-                        onChange={(e) => setSearchQuery(e.target.value)}\r\n-                    />\r\n-                    <button className=\"blue-button\" onClick={handleAddNewUser}>เพิ่มผู้ใช้ใหม่</button>\r\n-                </div>\r\n-                <UserTable data={filteredData} roleOptions={roleOptions} onEdit={handleEditUser} handleClickConfirm={handleClickConfirm} />\r\n-            </div>\r\n-            {showEditUser && (\r\n-                <EditUser\r\n-                    isEditing={isEditing}\r\n-                    user={userToEdit}\r\n-                    onClose={() => setShowEditUser(false)}\r\n-                    onSave={handleSaveUser}\r\n-                />\r\n-            )}\r\n-            \r\n-        </div>\r\n-    );\r\n-};\r\n-\r\n-export default UserManager;\r\n"
                },
                {
                    "date": 1739554269184,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -141,9 +141,9 @@\n                 <div className=\"search-container\">\r\n                     <input\r\n                         type=\"text\"\r\n                         className=\"search-input\"\r\n-                        placeholder=\"ค้นหาด้วยชื่อ จ้า รอบ 2 0.30\"\r\n+                        placeholder=\"ค้นหาด้วยชื่อ จ้า รอบ 2 0.30 กหกหกหก\"\r\n                         value={searchQuery}\r\n                         onChange={(e) => setSearchQuery(e.target.value)}\r\n                     />\r\n                     <button className=\"blue-button\" onClick={handleAddNewUser}>เพิ่มผู้ใช้ใหม่</button>\r\n"
                },
                {
                    "date": 1739554308543,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -63,9 +63,9 @@\n         if (isEditing) {\r\n             console.log('แก้ไข user  :', userToEdit._id);\r\n             axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n                 .then(res => {\r\n-                    console.log('User updated:', res.data);\r\n+                    console.log('User updated กหหหหหหหหหหหหหหหห:', res.data);\r\n                     setData(data.map(user => (user._id === res.data._id ? res.data : user)));\r\n                 })\r\n                 .catch(err => console.error('Failed to update user:', err));\r\n         } else {\r\n"
                },
                {
                    "date": 1739554449793,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -141,9 +141,9 @@\n                 <div className=\"search-container\">\r\n                     <input\r\n                         type=\"text\"\r\n                         className=\"search-input\"\r\n-                        placeholder=\"ค้นหาด้วยชื่อ จ้า รอบ 2 0.30 กหกหกหก\"\r\n+                        placeholder=\"ค้นหาด้วยชื่อ เช่น น้องแก้ม เฟื่อง\"\r\n                         value={searchQuery}\r\n                         onChange={(e) => setSearchQuery(e.target.value)}\r\n                     />\r\n                     <button className=\"blue-button\" onClick={handleAddNewUser}>เพิ่มผู้ใช้ใหม่</button>\r\n"
                },
                {
                    "date": 1739554676693,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,8 +4,9 @@\n import EditUser from './assets/EditUser';\r\n import UserTable from './assets/UserTable';\r\n import axios from 'axios';\r\n import Swal from 'sweetalert2';\r\n+import Grid from '@mui/material/Grid';\r\n \r\n const UserManager = () => {\r\n     const [data, setData] = useState([]);\r\n     const [searchQuery, setSearchQuery] = useState('');\r\n"
                },
                {
                    "date": 1739558629039,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -138,8 +138,11 @@\n \r\n     return (\r\n         <div className='container'>\r\n             <div className=\"middle-box\">\r\n+                <Grid>\r\n+                    \r\n+                </Grid>\r\n                 <div className=\"search-container\">\r\n                     <input\r\n                         type=\"text\"\r\n                         className=\"search-input\"\r\n"
                },
                {
                    "date": 1739625656936,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -61,9 +61,8 @@\n     };\r\n \r\n     const handleSaveUser = (updatedUser) => {\r\n         if (isEditing) {\r\n-            console.log('แก้ไข user  :', userToEdit._id);\r\n             axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n                 .then(res => {\r\n                     console.log('User updated กหหหหหหหหหหหหหหหห:', res.data);\r\n                     setData(data.map(user => (user._id === res.data._id ? res.data : user)));\r\n"
                },
                {
                    "date": 1740378864340,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -135,9 +135,9 @@\n         return <div className=\"error\">Error: {error}</div>;\r\n     }\r\n \r\n     return (\r\n-        <div className='container'>\r\n+        <>\r\n             <div className=\"middle-box\">\r\n                 <Grid>\r\n                     \r\n                 </Grid>\r\n@@ -161,9 +161,9 @@\n                     onSave={handleSaveUser}\r\n                 />\r\n             )}\r\n             \r\n-        </div>\r\n+        </>\r\n     );\r\n };\r\n \r\n export default UserManager;\r\n"
                },
                {
                    "date": 1740609975073,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,8 +6,13 @@\n import axios from 'axios';\r\n import Swal from 'sweetalert2';\r\n import Grid from '@mui/material/Grid';\r\n \r\n+{/* Bug check\r\n+    1. แก้ตาราง\r\n+    2. สำหรับ user ประเภท \"admin/เจ้าของร้าน\" จะไม่สามารถแก้ไขข้อมูลได้ ดูได้อย่างเดียว เพื่อป้องกันคนเข้ามาแก้ข้อมูล\r\n+    */}\r\n+\r\n const UserManager = () => {\r\n     const [data, setData] = useState([]);\r\n     const [searchQuery, setSearchQuery] = useState('');\r\n     const [showEditUser, setShowEditUser] = useState(false);\r\n"
                },
                {
                    "date": 1740609981001,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -9,9 +9,9 @@\n \r\n {/* Bug check\r\n     1. แก้ตาราง\r\n     2. สำหรับ user ประเภท \"admin/เจ้าของร้าน\" จะไม่สามารถแก้ไขข้อมูลได้ ดูได้อย่างเดียว เพื่อป้องกันคนเข้ามาแก้ข้อมูล\r\n-    */}\r\n+*/}\r\n \r\n const UserManager = () => {\r\n     const [data, setData] = useState([]);\r\n     const [searchQuery, setSearchQuery] = useState('');\r\n"
                },
                {
                    "date": 1740642968712,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,9 +28,9 @@\n         const fetchData = async () => {\r\n             try {\r\n                 const response = await axios.get('http://localhost:5000/api/users');\r\n                 setData(response.data);\r\n-                \r\n+\r\n             } catch (err) {\r\n                 console.error('Failed to fetch users:', err);\r\n                 setError('Failed to load user data.');\r\n             } finally {\r\n@@ -41,19 +41,19 @@\n \r\n         axios.get('http://localhost:5000/api/roles')\r\n             .then(res => {\r\n                 console.log('role จ้า: ', res.data);\r\n-                setRoleOptions(res.data); \r\n-                \r\n+                setRoleOptions(res.data);\r\n+\r\n             })\r\n             .catch(err => console.error('Error fetching :', err));\r\n \r\n     }, []);\r\n \r\n     const filteredData = data.filter(item =>\r\n         (item.id && item.id.includes(searchQuery)) || (item.name && item.name.includes(searchQuery))\r\n     );\r\n-    \r\n+\r\n     const handleEditUser = (user) => {\r\n         setUserToEdit(user);\r\n         setIsEditing(true); // Edit user mode\r\n         setShowEditUser(true);\r\n@@ -105,9 +105,9 @@\n                     confirmButtonText: 'OK',\r\n                 });\r\n             });\r\n     };\r\n-    \r\n+\r\n     const handleClickConfirm = (e) => {\r\n         setUserToDelete(e);\r\n         Swal.fire({\r\n             title: 'แน่ใจใช่ไหม?',\r\n@@ -129,10 +129,10 @@\n                 });\r\n             }\r\n         });\r\n     };\r\n-    \r\n \r\n+\r\n     if (loading) {\r\n         return <div className=\"loading\">Loading...</div>;\r\n     }\r\n \r\n@@ -141,12 +141,11 @@\n     }\r\n \r\n     return (\r\n         <>\r\n-            <div className=\"middle-box\">\r\n-                <Grid>\r\n-                    \r\n-                </Grid>\r\n+            <Box\r\n+                sx={{ backgroundColor: \"#fff\", width: isMobile ? \"100%\" : isTablet ? \"65%\" : \"75%\", height: \"100vh\", padding: \"20px\", borderRadius: \"8px\", overflowY: \"auto\", marginRight: \"10px\" }}\r\n+            >\r\n                 <div className=\"search-container\">\r\n                     <input\r\n                         type=\"text\"\r\n                         className=\"search-input\"\r\n@@ -156,18 +155,19 @@\n                     />\r\n                     <button className=\"blue-button\" onClick={handleAddNewUser}>เพิ่มผู้ใช้ใหม่</button>\r\n                 </div>\r\n                 <UserTable data={filteredData} roleOptions={roleOptions} onEdit={handleEditUser} handleClickConfirm={handleClickConfirm} />\r\n-            </div>\r\n+            </Box>\r\n+\r\n             {showEditUser && (\r\n                 <EditUser\r\n                     isEditing={isEditing}\r\n                     user={userToEdit}\r\n                     onClose={() => setShowEditUser(false)}\r\n                     onSave={handleSaveUser}\r\n                 />\r\n             )}\r\n-            \r\n+\r\n         </>\r\n     );\r\n };\r\n \r\n"
                },
                {
                    "date": 1740642985552,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -12,8 +12,11 @@\n     2. สำหรับ user ประเภท \"admin/เจ้าของร้าน\" จะไม่สามารถแก้ไขข้อมูลได้ ดูได้อย่างเดียว เพื่อป้องกันคนเข้ามาแก้ข้อมูล\r\n */}\r\n \r\n const UserManager = () => {\r\n+    const isMobile = useMediaQuery(\"(max-width: 767px)\");\r\n+    const isTablet = useMediaQuery(\"(min-width: 768px) and (max-width: 1040px)\");\r\n+\r\n     const [data, setData] = useState([]);\r\n     const [searchQuery, setSearchQuery] = useState('');\r\n     const [showEditUser, setShowEditUser] = useState(false);\r\n     const [userToEdit, setUserToEdit] = useState(null);\r\n"
                },
                {
                    "date": 1740642992500,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,9 @@\n import EditUser from './assets/EditUser';\r\n import UserTable from './assets/UserTable';\r\n import axios from 'axios';\r\n import Swal from 'sweetalert2';\r\n-import Grid from '@mui/material/Grid';\r\n+import { Box, useMediaQuery, Modal } from \"@mui/material\";\r\n \r\n {/* Bug check\r\n     1. แก้ตาราง\r\n     2. สำหรับ user ประเภท \"admin/เจ้าของร้าน\" จะไม่สามารถแก้ไขข้อมูลได้ ดูได้อย่างเดียว เพื่อป้องกันคนเข้ามาแก้ข้อมูล\r\n"
                },
                {
                    "date": 1740643607061,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -160,17 +160,60 @@\n                 </div>\r\n                 <UserTable data={filteredData} roleOptions={roleOptions} onEdit={handleEditUser} handleClickConfirm={handleClickConfirm} />\r\n             </Box>\r\n \r\n-            {showEditUser && (\r\n-                <EditUser\r\n-                    isEditing={isEditing}\r\n-                    user={userToEdit}\r\n-                    onClose={() => setShowEditUser(false)}\r\n-                    onSave={handleSaveUser}\r\n-                />\r\n+            {!isMobile && selectedData && (\r\n+                <Box\r\n+                    sx={{\r\n+                        backgroundColor: \"#fff\",\r\n+                        width: isTablet ? \"35%\" : \"25%\",\r\n+                        height: \"100vh\",\r\n+                        padding: \"20px\",\r\n+                        borderRadius: \"8px\",\r\n+                        overflowY: \"auto\",\r\n+                        display: \"flex\",\r\n+                        flexDirection: \"column\",\r\n+                    }}\r\n+                >\r\n+                    <EditUser\r\n+                        isEditing={isEditing}\r\n+                        user={userToEdit}\r\n+                        onClose={() => setShowEditUser(false)}\r\n+                        onSave={handleSaveUser}\r\n+                    />\r\n+                </Box>\r\n             )}\r\n \r\n+            {/* แสดงเป็น Modal สำหรับ Mobile */}\r\n+            {isMobile && (\r\n+                <Modal open={!!selectedData} onClose={() => setSelectedData(null)}>\r\n+                    <Box\r\n+                        sx={{\r\n+                            backgroundColor: \"#fff\",\r\n+                            padding: \"15px\",\r\n+                            borderRadius: \"8px\",\r\n+                            maxWidth: \"90vw\",\r\n+                            height: \"80vh\",\r\n+                            margin: \"10vh auto\",\r\n+                            overflowY: \"auto\",\r\n+                            display: \"flex\",\r\n+                            flexDirection: \"column\",\r\n+                        }}\r\n+                    >\r\n+                        {showEditUser && (\r\n+                            <EditUser\r\n+                                isEditing={isEditing}\r\n+                                user={userToEdit}\r\n+                                onClose={() => setShowEditUser(false)}\r\n+                                onSave={handleSaveUser}\r\n+                            />\r\n+                        )}\r\n+                    </Box>\r\n+                </Modal>\r\n+            )}\r\n+\r\n+\r\n+\r\n         </>\r\n     );\r\n };\r\n \r\n"
                },
                {
                    "date": 1740643660978,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -15,8 +15,11 @@\n const UserManager = () => {\r\n     const isMobile = useMediaQuery(\"(max-width: 767px)\");\r\n     const isTablet = useMediaQuery(\"(min-width: 768px) and (max-width: 1040px)\");\r\n \r\n+    const [selectedData, setSelectedData] = useState(null);\r\n+\r\n+\r\n     const [data, setData] = useState([]);\r\n     const [searchQuery, setSearchQuery] = useState('');\r\n     const [showEditUser, setShowEditUser] = useState(false);\r\n     const [userToEdit, setUserToEdit] = useState(null);\r\n"
                },
                {
                    "date": 1740643671713,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -15,12 +15,12 @@\n const UserManager = () => {\r\n     const isMobile = useMediaQuery(\"(max-width: 767px)\");\r\n     const isTablet = useMediaQuery(\"(min-width: 768px) and (max-width: 1040px)\");\r\n \r\n+    const [data, setData] = useState([]);\r\n     const [selectedData, setSelectedData] = useState(null);\r\n \r\n-\r\n-    const [data, setData] = useState([]);\r\n+    \r\n     const [searchQuery, setSearchQuery] = useState('');\r\n     const [showEditUser, setShowEditUser] = useState(false);\r\n     const [userToEdit, setUserToEdit] = useState(null);\r\n     const [isEditing, setIsEditing] = useState(false);\r\n"
                },
                {
                    "date": 1740643693347,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,9 +17,8 @@\n     const isTablet = useMediaQuery(\"(min-width: 768px) and (max-width: 1040px)\");\r\n \r\n     const [data, setData] = useState([]);\r\n     const [selectedData, setSelectedData] = useState(null);\r\n-\r\n     \r\n     const [searchQuery, setSearchQuery] = useState('');\r\n     const [showEditUser, setShowEditUser] = useState(false);\r\n     const [userToEdit, setUserToEdit] = useState(null);\r\n@@ -60,15 +59,16 @@\n     );\r\n \r\n     const handleEditUser = (user) => {\r\n         setUserToEdit(user);\r\n-        setIsEditing(true); // Edit user mode\r\n+        setSelectedData(user); \r\n+        setIsEditing(true);\r\n         setShowEditUser(true);\r\n     };\r\n \r\n     const handleAddNewUser = () => {\r\n         setUserToEdit({ id: '', name: '', nickname: '', roll: '', status: 'offline', phone: '' });\r\n-        setIsEditing(false); // Add new user mode\r\n+        setIsEditing(false);\r\n         setShowEditUser(true);\r\n     };\r\n \r\n     const handleSaveUser = (updatedUser) => {\r\n"
                },
                {
                    "date": 1740644062339,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -74,17 +74,15 @@\n     const handleSaveUser = (updatedUser) => {\r\n         if (isEditing) {\r\n             axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n                 .then(res => {\r\n-                    console.log('User updated กหหหหหหหหหหหหหหหห:', res.data);\r\n                     setData(data.map(user => (user._id === res.data._id ? res.data : user)));\r\n                 })\r\n                 .catch(err => console.error('Failed to update user:', err));\r\n         } else {\r\n             console.log('เพิ่ม user:', updatedUser);\r\n             axios.post('http://localhost:5000/api/users', updatedUser)\r\n                 .then(res => {\r\n-                    console.log('User added:', res.data);\r\n                     setData([...data, res.data]);\r\n                 })\r\n                 .catch(err => console.error('Failed to add user:', err));\r\n         }\r\n"
                },
                {
                    "date": 1740645369448,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -134,17 +134,8 @@\n             }\r\n         });\r\n     };\r\n \r\n-\r\n-    if (loading) {\r\n-        return <div className=\"loading\">Loading...</div>;\r\n-    }\r\n-\r\n-    if (error) {\r\n-        return <div className=\"error\">Error: {error}</div>;\r\n-    }\r\n-\r\n     return (\r\n         <>\r\n             <Box\r\n                 sx={{ backgroundColor: \"#fff\", width: isMobile ? \"100%\" : isTablet ? \"65%\" : \"75%\", height: \"100vh\", padding: \"20px\", borderRadius: \"8px\", overflowY: \"auto\", marginRight: \"10px\" }}\r\n"
                },
                {
                    "date": 1740645424421,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -17,9 +17,9 @@\n     const isTablet = useMediaQuery(\"(min-width: 768px) and (max-width: 1040px)\");\r\n \r\n     const [data, setData] = useState([]);\r\n     const [selectedData, setSelectedData] = useState(null);\r\n-    \r\n+\r\n     const [searchQuery, setSearchQuery] = useState('');\r\n     const [showEditUser, setShowEditUser] = useState(false);\r\n     const [userToEdit, setUserToEdit] = useState(null);\r\n     const [isEditing, setIsEditing] = useState(false);\r\n@@ -59,9 +59,9 @@\n     );\r\n \r\n     const handleEditUser = (user) => {\r\n         setUserToEdit(user);\r\n-        setSelectedData(user); \r\n+        setSelectedData(user);\r\n         setIsEditing(true);\r\n         setShowEditUser(true);\r\n     };\r\n \r\n@@ -165,14 +165,17 @@\n                         display: \"flex\",\r\n                         flexDirection: \"column\",\r\n                     }}\r\n                 >\r\n-                    <EditUser\r\n-                        isEditing={isEditing}\r\n-                        user={userToEdit}\r\n-                        onClose={() => setShowEditUser(false)}\r\n-                        onSave={handleSaveUser}\r\n-                    />\r\n+                    {isEditing && (\r\n+                        <EditUser\r\n+                            isEditing={isEditing}\r\n+                            user={userToEdit}\r\n+                            onClose={() => setShowEditUser(false)}\r\n+                            onSave={handleSaveUser}\r\n+                        />\r\n+                    )}\r\n+\r\n                 </Box>\r\n             )}\r\n \r\n             {/* แสดงเป็น Modal สำหรับ Mobile */}\r\n"
                },
                {
                    "date": 1740645431033,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -193,16 +193,17 @@\n                             display: \"flex\",\r\n                             flexDirection: \"column\",\r\n                         }}\r\n                     >\r\n-                        {showEditUser && (\r\n+                        {isEditing && (\r\n                             <EditUser\r\n                                 isEditing={isEditing}\r\n                                 user={userToEdit}\r\n                                 onClose={() => setShowEditUser(false)}\r\n                                 onSave={handleSaveUser}\r\n                             />\r\n                         )}\r\n+\r\n                     </Box>\r\n                 </Modal>\r\n             )}\r\n \r\n"
                },
                {
                    "date": 1740645511951,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -165,17 +165,18 @@\n                         display: \"flex\",\r\n                         flexDirection: \"column\",\r\n                     }}\r\n                 >\r\n-                    {isEditing && (\r\n+                    {showEditUser && (\r\n                         <EditUser\r\n                             isEditing={isEditing}\r\n                             user={userToEdit}\r\n                             onClose={() => setShowEditUser(false)}\r\n                             onSave={handleSaveUser}\r\n                         />\r\n                     )}\r\n \r\n+\r\n                 </Box>\r\n             )}\r\n \r\n             {/* แสดงเป็น Modal สำหรับ Mobile */}\r\n@@ -193,17 +194,18 @@\n                             display: \"flex\",\r\n                             flexDirection: \"column\",\r\n                         }}\r\n                     >\r\n-                        {isEditing && (\r\n+                        {showEditUser && (\r\n                             <EditUser\r\n                                 isEditing={isEditing}\r\n                                 user={userToEdit}\r\n                                 onClose={() => setShowEditUser(false)}\r\n                                 onSave={handleSaveUser}\r\n                             />\r\n                         )}\r\n \r\n+\r\n                     </Box>\r\n                 </Modal>\r\n             )}\r\n \r\n"
                },
                {
                    "date": 1740645637129,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -65,12 +65,14 @@\n         setShowEditUser(true);\r\n     };\r\n \r\n     const handleAddNewUser = () => {\r\n+        console.log('เพิ่มผู้ใช้ใหม่ถูกกด'); // Debug\r\n         setUserToEdit({ id: '', name: '', nickname: '', roll: '', status: 'offline', phone: '' });\r\n         setIsEditing(false);\r\n         setShowEditUser(true);\r\n     };\r\n+    \r\n \r\n     const handleSaveUser = (updatedUser) => {\r\n         if (isEditing) {\r\n             axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n"
                },
                {
                    "date": 1740645647727,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -69,10 +69,9 @@\n         console.log('เพิ่มผู้ใช้ใหม่ถูกกด'); // Debug\r\n         setUserToEdit({ id: '', name: '', nickname: '', roll: '', status: 'offline', phone: '' });\r\n         setIsEditing(false);\r\n         setShowEditUser(true);\r\n-    };\r\n-    \r\n+    };    \r\n \r\n     const handleSaveUser = (updatedUser) => {\r\n         if (isEditing) {\r\n             axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n"
                },
                {
                    "date": 1740645722052,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,219 @@\n+import React, { useState, useEffect } from 'react';\r\n+import './UserManager.css';\r\n+import '../IngredientManager/IngredientManager.css';\r\n+import EditUser from './assets/EditUser';\r\n+import UserTable from './assets/UserTable';\r\n+import axios from 'axios';\r\n+import Swal from 'sweetalert2';\r\n+import { Box, useMediaQuery, Modal } from \"@mui/material\";\r\n+\r\n+{/* Bug check\r\n+    1. แก้ตาราง\r\n+    2. สำหรับ user ประเภท \"admin/เจ้าของร้าน\" จะไม่สามารถแก้ไขข้อมูลได้ ดูได้อย่างเดียว เพื่อป้องกันคนเข้ามาแก้ข้อมูล\r\n+*/}\r\n+\r\n+const UserManager = () => {\r\n+    const isMobile = useMediaQuery(\"(max-width: 767px)\");\r\n+    const isTablet = useMediaQuery(\"(min-width: 768px) and (max-width: 1040px)\");\r\n+\r\n+    const [data, setData] = useState([]);\r\n+    const [selectedData, setSelectedData] = useState(null);\r\n+\r\n+    const [searchQuery, setSearchQuery] = useState('');\r\n+    const [showEditUser, setShowEditUser] = useState(false);\r\n+    const [userToEdit, setUserToEdit] = useState(null);\r\n+    const [isEditing, setIsEditing] = useState(false);\r\n+    const [loading, setLoading] = useState(true);\r\n+    const [error, setError] = useState(null);\r\n+    const [roleOptions, setRoleOptions] = useState([]);\r\n+    const [userToDelete, setUserToDelete] = useState(null);\r\n+\r\n+    // Fetch data from the API\r\n+    useEffect(() => {\r\n+        const fetchData = async () => {\r\n+            try {\r\n+                const response = await axios.get('http://localhost:5000/api/users');\r\n+                setData(response.data);\r\n+\r\n+            } catch (err) {\r\n+                console.error('Failed to fetch users:', err);\r\n+                setError('Failed to load user data.');\r\n+            } finally {\r\n+                setLoading(false);\r\n+            }\r\n+        };\r\n+        fetchData();\r\n+\r\n+        axios.get('http://localhost:5000/api/roles')\r\n+            .then(res => {\r\n+                console.log('role จ้า: ', res.data);\r\n+                setRoleOptions(res.data);\r\n+\r\n+            })\r\n+            .catch(err => console.error('Error fetching :', err));\r\n+\r\n+    }, []);\r\n+\r\n+    const filteredData = data.filter(item =>\r\n+        (item.id && item.id.includes(searchQuery)) || (item.name && item.name.includes(searchQuery))\r\n+    );\r\n+\r\n+    const handleEditUser = (user) => {\r\n+        setUserToEdit(user);\r\n+        setSelectedData(user);\r\n+        setIsEditing(true);\r\n+        setShowEditUser(true);\r\n+    };\r\n+\r\n+    const handleAddNewUser = () => {\r\n+        setUserToEdit({ id: '', name: '', nickname: '', roll: '', status: 'offline', phone: '' });\r\n+        setIsEditing(false);\r\n+        setShowEditUser(true); \r\n+    };\r\n+    \r\n+\r\n+    const handleSaveUser = (updatedUser) => {\r\n+        if (isEditing) {\r\n+            axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n+                .then(res => {\r\n+                    setData(data.map(user => (user._id === res.data._id ? res.data : user)));\r\n+                })\r\n+                .catch(err => console.error('Failed to update user:', err));\r\n+        } else {\r\n+            console.log('เพิ่ม user:', updatedUser);\r\n+            axios.post('http://localhost:5000/api/users', updatedUser)\r\n+                .then(res => {\r\n+                    setData([...data, res.data]);\r\n+                })\r\n+                .catch(err => console.error('Failed to add user:', err));\r\n+        }\r\n+        setShowEditUser(false);\r\n+    };\r\n+\r\n+    const handleDeleteUser = (user) => {\r\n+        axios.delete(`http://localhost:5000/api/users/${user._id}`)\r\n+            .then((res) => {\r\n+                Swal.fire({\r\n+                    title: 'ผู้ใช้ดังกล่าวถูกลบแล้ว!',\r\n+                    icon: 'success',\r\n+                    confirmButtonColor: \"#64A2FF\",\r\n+                    confirmButtonText: 'OK',\r\n+                });\r\n+                setData((prevData) => prevData.filter((item) => item._id !== user._id));\r\n+            })\r\n+            .catch((err) => {\r\n+                Swal.fire({\r\n+                    title: 'เกิดข้อผิดพลาดในการลบผู้ใช้ดังกล่าว',\r\n+                    text: 'ลองใหม่อีกครั้ง',\r\n+                    icon: 'error',\r\n+                    confirmButtonColor: \"#64A2FF\",\r\n+                    confirmButtonText: 'OK',\r\n+                });\r\n+            });\r\n+    };\r\n+\r\n+    const handleClickConfirm = (e) => {\r\n+        setUserToDelete(e);\r\n+        Swal.fire({\r\n+            title: 'แน่ใจใช่ไหม?',\r\n+            text: `คุณกำลังจะลบผู้ใช้\\nชื่อ: ${e.name}\\nตำแหน่ง: ${roleOptions.find(role => role._id === e.role_id)?.role_name}`,\r\n+            icon: 'warning',\r\n+            showCancelButton: true,\r\n+            confirmButtonColor: \"#ff4b4b\",\r\n+            cancelButtonColor: \"#B2B2B2\",\r\n+            confirmButtonText: 'ยืนยันการลบ',\r\n+            cancelButtonText: 'ยกเลิก',\r\n+            dangerMode: true,\r\n+        }).then((result) => {\r\n+            if (result.isConfirmed) {\r\n+                handleDeleteUser(e);\r\n+            } else {\r\n+                Swal.fire({\r\n+                    title: 'ยกเลิกการลบ',\r\n+                    confirmButtonColor: '#64A2FF',\r\n+                });\r\n+            }\r\n+        });\r\n+    };\r\n+\r\n+    return (\r\n+        <>\r\n+            <Box\r\n+                sx={{ backgroundColor: \"#fff\", width: isMobile ? \"100%\" : isTablet ? \"65%\" : \"75%\", height: \"100vh\", padding: \"20px\", borderRadius: \"8px\", overflowY: \"auto\", marginRight: \"10px\" }}\r\n+            >\r\n+                <div className=\"search-container\">\r\n+                    <input\r\n+                        type=\"text\"\r\n+                        className=\"search-input\"\r\n+                        placeholder=\"ค้นหาด้วยชื่อ เช่น น้องแก้ม เฟื่อง\"\r\n+                        value={searchQuery}\r\n+                        onChange={(e) => setSearchQuery(e.target.value)}\r\n+                    />\r\n+                    <button className=\"blue-button\" onClick={handleAddNewUser}>เพิ่มผู้ใช้ใหม่</button>\r\n+                </div>\r\n+                <UserTable data={filteredData} roleOptions={roleOptions} onEdit={handleEditUser} handleClickConfirm={handleClickConfirm} />\r\n+            </Box>\r\n+\r\n+            {!isMobile && selectedData && (\r\n+                <Box\r\n+                    sx={{\r\n+                        backgroundColor: \"#fff\",\r\n+                        width: isTablet ? \"35%\" : \"25%\",\r\n+                        height: \"100vh\",\r\n+                        padding: \"20px\",\r\n+                        borderRadius: \"8px\",\r\n+                        overflowY: \"auto\",\r\n+                        display: \"flex\",\r\n+                        flexDirection: \"column\",\r\n+                    }}\r\n+                >\r\n+                    {showEditUser && (\r\n+                        <EditUser\r\n+                            isEditing={isEditing}\r\n+                            user={userToEdit}\r\n+                            onClose={() => setShowEditUser(false)}\r\n+                            onSave={handleSaveUser}\r\n+                        />\r\n+                    )}\r\n+\r\n+\r\n+                </Box>\r\n+            )}\r\n+\r\n+            {/* แสดงเป็น Modal สำหรับ Mobile */}\r\n+            {isMobile && (\r\n+                <Modal open={!!selectedData} onClose={() => setSelectedData(null)}>\r\n+                    <Box\r\n+                        sx={{\r\n+                            backgroundColor: \"#fff\",\r\n+                            padding: \"15px\",\r\n+                            borderRadius: \"8px\",\r\n+                            maxWidth: \"90vw\",\r\n+                            height: \"80vh\",\r\n+                            margin: \"10vh auto\",\r\n+                            overflowY: \"auto\",\r\n+                            display: \"flex\",\r\n+                            flexDirection: \"column\",\r\n+                        }}\r\n+                    >\r\n+                        {showEditUser && (\r\n+                            <EditUser\r\n+                                isEditing={isEditing}\r\n+                                user={userToEdit}\r\n+                                onClose={() => setShowEditUser(false)}\r\n+                                onSave={handleSaveUser}\r\n+                            />\r\n+                        )}\r\n+\r\n+\r\n+                    </Box>\r\n+                </Modal>\r\n+            )}\r\n+\r\n+\r\n+\r\n+        </>\r\n+    );\r\n+};\r\n+\r\n+export default UserManager;\r\n"
                },
                {
                    "date": 1740645727467,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -65,9 +65,9 @@\n         setShowEditUser(true);\r\n     };\r\n \r\n     const handleAddNewUser = () => {\r\n-        setUserToEdit({ id: '', name: '', nickname: '', roll: '', status: 'offline', phone: '' });\r\n+        setUserToEdit({ id: '', name: '', nickname: '', roll: '', phone: '' });\r\n         setIsEditing(false);\r\n         setShowEditUser(true); \r\n     };\r\n     \r\n@@ -216,223 +216,4 @@\n     );\r\n };\r\n \r\n export default UserManager;\r\n-import React, { useState, useEffect } from 'react';\r\n-import './UserManager.css';\r\n-import '../IngredientManager/IngredientManager.css';\r\n-import EditUser from './assets/EditUser';\r\n-import UserTable from './assets/UserTable';\r\n-import axios from 'axios';\r\n-import Swal from 'sweetalert2';\r\n-import { Box, useMediaQuery, Modal } from \"@mui/material\";\r\n-\r\n-{/* Bug check\r\n-    1. แก้ตาราง\r\n-    2. สำหรับ user ประเภท \"admin/เจ้าของร้าน\" จะไม่สามารถแก้ไขข้อมูลได้ ดูได้อย่างเดียว เพื่อป้องกันคนเข้ามาแก้ข้อมูล\r\n-*/}\r\n-\r\n-const UserManager = () => {\r\n-    const isMobile = useMediaQuery(\"(max-width: 767px)\");\r\n-    const isTablet = useMediaQuery(\"(min-width: 768px) and (max-width: 1040px)\");\r\n-\r\n-    const [data, setData] = useState([]);\r\n-    const [selectedData, setSelectedData] = useState(null);\r\n-\r\n-    const [searchQuery, setSearchQuery] = useState('');\r\n-    const [showEditUser, setShowEditUser] = useState(false);\r\n-    const [userToEdit, setUserToEdit] = useState(null);\r\n-    const [isEditing, setIsEditing] = useState(false);\r\n-    const [loading, setLoading] = useState(true);\r\n-    const [error, setError] = useState(null);\r\n-    const [roleOptions, setRoleOptions] = useState([]);\r\n-    const [userToDelete, setUserToDelete] = useState(null);\r\n-\r\n-    // Fetch data from the API\r\n-    useEffect(() => {\r\n-        const fetchData = async () => {\r\n-            try {\r\n-                const response = await axios.get('http://localhost:5000/api/users');\r\n-                setData(response.data);\r\n-\r\n-            } catch (err) {\r\n-                console.error('Failed to fetch users:', err);\r\n-                setError('Failed to load user data.');\r\n-            } finally {\r\n-                setLoading(false);\r\n-            }\r\n-        };\r\n-        fetchData();\r\n-\r\n-        axios.get('http://localhost:5000/api/roles')\r\n-            .then(res => {\r\n-                console.log('role จ้า: ', res.data);\r\n-                setRoleOptions(res.data);\r\n-\r\n-            })\r\n-            .catch(err => console.error('Error fetching :', err));\r\n-\r\n-    }, []);\r\n-\r\n-    const filteredData = data.filter(item =>\r\n-        (item.id && item.id.includes(searchQuery)) || (item.name && item.name.includes(searchQuery))\r\n-    );\r\n-\r\n-    const handleEditUser = (user) => {\r\n-        setUserToEdit(user);\r\n-        setSelectedData(user);\r\n-        setIsEditing(true);\r\n-        setShowEditUser(true);\r\n-    };\r\n-\r\n-    const handleAddNewUser = () => {\r\n-        console.log('เพิ่มผู้ใช้ใหม่ถูกกด'); // Debug\r\n-        setUserToEdit({ id: '', name: '', nickname: '', roll: '', status: 'offline', phone: '' });\r\n-        setIsEditing(false);\r\n-        setShowEditUser(true);\r\n-    };    \r\n-\r\n-    const handleSaveUser = (updatedUser) => {\r\n-        if (isEditing) {\r\n-            axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n-                .then(res => {\r\n-                    setData(data.map(user => (user._id === res.data._id ? res.data : user)));\r\n-                })\r\n-                .catch(err => console.error('Failed to update user:', err));\r\n-        } else {\r\n-            console.log('เพิ่ม user:', updatedUser);\r\n-            axios.post('http://localhost:5000/api/users', updatedUser)\r\n-                .then(res => {\r\n-                    setData([...data, res.data]);\r\n-                })\r\n-                .catch(err => console.error('Failed to add user:', err));\r\n-        }\r\n-        setShowEditUser(false);\r\n-    };\r\n-\r\n-    const handleDeleteUser = (user) => {\r\n-        axios.delete(`http://localhost:5000/api/users/${user._id}`)\r\n-            .then((res) => {\r\n-                Swal.fire({\r\n-                    title: 'ผู้ใช้ดังกล่าวถูกลบแล้ว!',\r\n-                    icon: 'success',\r\n-                    confirmButtonColor: \"#64A2FF\",\r\n-                    confirmButtonText: 'OK',\r\n-                });\r\n-                setData((prevData) => prevData.filter((item) => item._id !== user._id));\r\n-            })\r\n-            .catch((err) => {\r\n-                Swal.fire({\r\n-                    title: 'เกิดข้อผิดพลาดในการลบผู้ใช้ดังกล่าว',\r\n-                    text: 'ลองใหม่อีกครั้ง',\r\n-                    icon: 'error',\r\n-                    confirmButtonColor: \"#64A2FF\",\r\n-                    confirmButtonText: 'OK',\r\n-                });\r\n-            });\r\n-    };\r\n-\r\n-    const handleClickConfirm = (e) => {\r\n-        setUserToDelete(e);\r\n-        Swal.fire({\r\n-            title: 'แน่ใจใช่ไหม?',\r\n-            text: `คุณกำลังจะลบผู้ใช้\\nชื่อ: ${e.name}\\nตำแหน่ง: ${roleOptions.find(role => role._id === e.role_id)?.role_name}`,\r\n-            icon: 'warning',\r\n-            showCancelButton: true,\r\n-            confirmButtonColor: \"#ff4b4b\",\r\n-            cancelButtonColor: \"#B2B2B2\",\r\n-            confirmButtonText: 'ยืนยันการลบ',\r\n-            cancelButtonText: 'ยกเลิก',\r\n-            dangerMode: true,\r\n-        }).then((result) => {\r\n-            if (result.isConfirmed) {\r\n-                handleDeleteUser(e);\r\n-            } else {\r\n-                Swal.fire({\r\n-                    title: 'ยกเลิกการลบ',\r\n-                    confirmButtonColor: '#64A2FF',\r\n-                });\r\n-            }\r\n-        });\r\n-    };\r\n-\r\n-    return (\r\n-        <>\r\n-            <Box\r\n-                sx={{ backgroundColor: \"#fff\", width: isMobile ? \"100%\" : isTablet ? \"65%\" : \"75%\", height: \"100vh\", padding: \"20px\", borderRadius: \"8px\", overflowY: \"auto\", marginRight: \"10px\" }}\r\n-            >\r\n-                <div className=\"search-container\">\r\n-                    <input\r\n-                        type=\"text\"\r\n-                        className=\"search-input\"\r\n-                        placeholder=\"ค้นหาด้วยชื่อ เช่น น้องแก้ม เฟื่อง\"\r\n-                        value={searchQuery}\r\n-                        onChange={(e) => setSearchQuery(e.target.value)}\r\n-                    />\r\n-                    <button className=\"blue-button\" onClick={handleAddNewUser}>เพิ่มผู้ใช้ใหม่</button>\r\n-                </div>\r\n-                <UserTable data={filteredData} roleOptions={roleOptions} onEdit={handleEditUser} handleClickConfirm={handleClickConfirm} />\r\n-            </Box>\r\n-\r\n-            {!isMobile && selectedData && (\r\n-                <Box\r\n-                    sx={{\r\n-                        backgroundColor: \"#fff\",\r\n-                        width: isTablet ? \"35%\" : \"25%\",\r\n-                        height: \"100vh\",\r\n-                        padding: \"20px\",\r\n-                        borderRadius: \"8px\",\r\n-                        overflowY: \"auto\",\r\n-                        display: \"flex\",\r\n-                        flexDirection: \"column\",\r\n-                    }}\r\n-                >\r\n-                    {showEditUser && (\r\n-                        <EditUser\r\n-                            isEditing={isEditing}\r\n-                            user={userToEdit}\r\n-                            onClose={() => setShowEditUser(false)}\r\n-                            onSave={handleSaveUser}\r\n-                        />\r\n-                    )}\r\n-\r\n-\r\n-                </Box>\r\n-            )}\r\n-\r\n-            {/* แสดงเป็น Modal สำหรับ Mobile */}\r\n-            {isMobile && (\r\n-                <Modal open={!!selectedData} onClose={() => setSelectedData(null)}>\r\n-                    <Box\r\n-                        sx={{\r\n-                            backgroundColor: \"#fff\",\r\n-                            padding: \"15px\",\r\n-                            borderRadius: \"8px\",\r\n-                            maxWidth: \"90vw\",\r\n-                            height: \"80vh\",\r\n-                            margin: \"10vh auto\",\r\n-                            overflowY: \"auto\",\r\n-                            display: \"flex\",\r\n-                            flexDirection: \"column\",\r\n-                        }}\r\n-                    >\r\n-                        {showEditUser && (\r\n-                            <EditUser\r\n-                                isEditing={isEditing}\r\n-                                user={userToEdit}\r\n-                                onClose={() => setShowEditUser(false)}\r\n-                                onSave={handleSaveUser}\r\n-                            />\r\n-                        )}\r\n-\r\n-\r\n-                    </Box>\r\n-                </Modal>\r\n-            )}\r\n-\r\n-\r\n-\r\n-        </>\r\n-    );\r\n-};\r\n-\r\n-export default UserManager;\r\n"
                },
                {
                    "date": 1740645737255,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -67,11 +67,10 @@\n \r\n     const handleAddNewUser = () => {\r\n         setUserToEdit({ id: '', name: '', nickname: '', roll: '', phone: '' });\r\n         setIsEditing(false);\r\n-        setShowEditUser(true); \r\n+        setShowEditUser(true);\r\n     };\r\n-    \r\n \r\n     const handleSaveUser = (updatedUser) => {\r\n         if (isEditing) {\r\n             axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n"
                },
                {
                    "date": 1740645763404,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -165,9 +165,9 @@\n                         display: \"flex\",\r\n                         flexDirection: \"column\",\r\n                     }}\r\n                 >\r\n-                    {showEditUser && (\r\n+                    {showEditUser && (setUserToEdit) && (\r\n                         <EditUser\r\n                             isEditing={isEditing}\r\n                             user={userToEdit}\r\n                             onClose={() => setShowEditUser(false)}\r\n"
                },
                {
                    "date": 1740645770258,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -165,9 +165,9 @@\n                         display: \"flex\",\r\n                         flexDirection: \"column\",\r\n                     }}\r\n                 >\r\n-                    {showEditUser && (setUserToEdit) && (\r\n+                    {showEditUser ฿฿  && (\r\n                         <EditUser\r\n                             isEditing={isEditing}\r\n                             user={userToEdit}\r\n                             onClose={() => setShowEditUser(false)}\r\n"
                },
                {
                    "date": 1740645882221,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,140 +6,73 @@\n import axios from 'axios';\r\n import Swal from 'sweetalert2';\r\n import { Box, useMediaQuery, Modal } from \"@mui/material\";\r\n \r\n-{/* Bug check\r\n-    1. แก้ตาราง\r\n-    2. สำหรับ user ประเภท \"admin/เจ้าของร้าน\" จะไม่สามารถแก้ไขข้อมูลได้ ดูได้อย่างเดียว เพื่อป้องกันคนเข้ามาแก้ข้อมูล\r\n-*/}\r\n-\r\n const UserManager = () => {\r\n     const isMobile = useMediaQuery(\"(max-width: 767px)\");\r\n     const isTablet = useMediaQuery(\"(min-width: 768px) and (max-width: 1040px)\");\r\n \r\n     const [data, setData] = useState([]);\r\n-    const [selectedData, setSelectedData] = useState(null);\r\n-\r\n     const [searchQuery, setSearchQuery] = useState('');\r\n     const [showEditUser, setShowEditUser] = useState(false);\r\n     const [userToEdit, setUserToEdit] = useState(null);\r\n     const [isEditing, setIsEditing] = useState(false);\r\n-    const [loading, setLoading] = useState(true);\r\n-    const [error, setError] = useState(null);\r\n     const [roleOptions, setRoleOptions] = useState([]);\r\n-    const [userToDelete, setUserToDelete] = useState(null);\r\n \r\n-    // Fetch data from the API\r\n     useEffect(() => {\r\n         const fetchData = async () => {\r\n             try {\r\n                 const response = await axios.get('http://localhost:5000/api/users');\r\n                 setData(response.data);\r\n-\r\n             } catch (err) {\r\n                 console.error('Failed to fetch users:', err);\r\n-                setError('Failed to load user data.');\r\n-            } finally {\r\n-                setLoading(false);\r\n             }\r\n         };\r\n         fetchData();\r\n \r\n         axios.get('http://localhost:5000/api/roles')\r\n-            .then(res => {\r\n-                console.log('role จ้า: ', res.data);\r\n-                setRoleOptions(res.data);\r\n-\r\n-            })\r\n-            .catch(err => console.error('Error fetching :', err));\r\n-\r\n+            .then(res => setRoleOptions(res.data))\r\n+            .catch(err => console.error('Error fetching roles:', err));\r\n     }, []);\r\n \r\n-    const filteredData = data.filter(item =>\r\n-        (item.id && item.id.includes(searchQuery)) || (item.name && item.name.includes(searchQuery))\r\n-    );\r\n-\r\n     const handleEditUser = (user) => {\r\n         setUserToEdit(user);\r\n-        setSelectedData(user);\r\n         setIsEditing(true);\r\n         setShowEditUser(true);\r\n     };\r\n \r\n     const handleAddNewUser = () => {\r\n         setUserToEdit({ id: '', name: '', nickname: '', roll: '', phone: '' });\r\n         setIsEditing(false);\r\n         setShowEditUser(true);\r\n+        console.log(\"เปิด Modal:\", showEditUser);\r\n     };\r\n \r\n     const handleSaveUser = (updatedUser) => {\r\n         if (isEditing) {\r\n             axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n-                .then(res => {\r\n-                    setData(data.map(user => (user._id === res.data._id ? res.data : user)));\r\n-                })\r\n+                .then(res => setData(data.map(user => (user._id === res.data._id ? res.data : user))))\r\n                 .catch(err => console.error('Failed to update user:', err));\r\n         } else {\r\n-            console.log('เพิ่ม user:', updatedUser);\r\n             axios.post('http://localhost:5000/api/users', updatedUser)\r\n-                .then(res => {\r\n-                    setData([...data, res.data]);\r\n-                })\r\n+                .then(res => setData([...data, res.data]))\r\n                 .catch(err => console.error('Failed to add user:', err));\r\n         }\r\n         setShowEditUser(false);\r\n     };\r\n \r\n-    const handleDeleteUser = (user) => {\r\n-        axios.delete(`http://localhost:5000/api/users/${user._id}`)\r\n-            .then((res) => {\r\n-                Swal.fire({\r\n-                    title: 'ผู้ใช้ดังกล่าวถูกลบแล้ว!',\r\n-                    icon: 'success',\r\n-                    confirmButtonColor: \"#64A2FF\",\r\n-                    confirmButtonText: 'OK',\r\n-                });\r\n-                setData((prevData) => prevData.filter((item) => item._id !== user._id));\r\n-            })\r\n-            .catch((err) => {\r\n-                Swal.fire({\r\n-                    title: 'เกิดข้อผิดพลาดในการลบผู้ใช้ดังกล่าว',\r\n-                    text: 'ลองใหม่อีกครั้ง',\r\n-                    icon: 'error',\r\n-                    confirmButtonColor: \"#64A2FF\",\r\n-                    confirmButtonText: 'OK',\r\n-                });\r\n-            });\r\n-    };\r\n-\r\n-    const handleClickConfirm = (e) => {\r\n-        setUserToDelete(e);\r\n-        Swal.fire({\r\n-            title: 'แน่ใจใช่ไหม?',\r\n-            text: `คุณกำลังจะลบผู้ใช้\\nชื่อ: ${e.name}\\nตำแหน่ง: ${roleOptions.find(role => role._id === e.role_id)?.role_name}`,\r\n-            icon: 'warning',\r\n-            showCancelButton: true,\r\n-            confirmButtonColor: \"#ff4b4b\",\r\n-            cancelButtonColor: \"#B2B2B2\",\r\n-            confirmButtonText: 'ยืนยันการลบ',\r\n-            cancelButtonText: 'ยกเลิก',\r\n-            dangerMode: true,\r\n-        }).then((result) => {\r\n-            if (result.isConfirmed) {\r\n-                handleDeleteUser(e);\r\n-            } else {\r\n-                Swal.fire({\r\n-                    title: 'ยกเลิกการลบ',\r\n-                    confirmButtonColor: '#64A2FF',\r\n-                });\r\n-            }\r\n-        });\r\n-    };\r\n-\r\n     return (\r\n         <>\r\n             <Box\r\n-                sx={{ backgroundColor: \"#fff\", width: isMobile ? \"100%\" : isTablet ? \"65%\" : \"75%\", height: \"100vh\", padding: \"20px\", borderRadius: \"8px\", overflowY: \"auto\", marginRight: \"10px\" }}\r\n+                sx={{\r\n+                    backgroundColor: \"#fff\",\r\n+                    width: isMobile ? \"100%\" : isTablet ? \"65%\" : \"75%\",\r\n+                    height: \"100vh\",\r\n+                    padding: \"20px\",\r\n+                    borderRadius: \"8px\",\r\n+                    overflowY: \"auto\",\r\n+                    marginRight: \"10px\"\r\n+                }}\r\n             >\r\n                 <div className=\"search-container\">\r\n                     <input\r\n                         type=\"text\"\r\n@@ -149,12 +82,12 @@\n                         onChange={(e) => setSearchQuery(e.target.value)}\r\n                     />\r\n                     <button className=\"blue-button\" onClick={handleAddNewUser}>เพิ่มผู้ใช้ใหม่</button>\r\n                 </div>\r\n-                <UserTable data={filteredData} roleOptions={roleOptions} onEdit={handleEditUser} handleClickConfirm={handleClickConfirm} />\r\n+                <UserTable data={data} roleOptions={roleOptions} onEdit={handleEditUser} />\r\n             </Box>\r\n \r\n-            {!isMobile && selectedData && (\r\n+            {!isMobile && showEditUser && (\r\n                 <Box\r\n                     sx={{\r\n                         backgroundColor: \"#fff\",\r\n                         width: isTablet ? \"35%\" : \"25%\",\r\n@@ -165,24 +98,19 @@\n                         display: \"flex\",\r\n                         flexDirection: \"column\",\r\n                     }}\r\n                 >\r\n-                    {showEditUser ฿฿  && (\r\n-                        <EditUser\r\n-                            isEditing={isEditing}\r\n-                            user={userToEdit}\r\n-                            onClose={() => setShowEditUser(false)}\r\n-                            onSave={handleSaveUser}\r\n-                        />\r\n-                    )}\r\n-\r\n-\r\n+                    <EditUser\r\n+                        isEditing={isEditing}\r\n+                        user={userToEdit}\r\n+                        onClose={() => setShowEditUser(false)}\r\n+                        onSave={handleSaveUser}\r\n+                    />\r\n                 </Box>\r\n             )}\r\n \r\n-            {/* แสดงเป็น Modal สำหรับ Mobile */}\r\n             {isMobile && (\r\n-                <Modal open={!!selectedData} onClose={() => setSelectedData(null)}>\r\n+                <Modal open={showEditUser} onClose={() => setShowEditUser(false)}>\r\n                     <Box\r\n                         sx={{\r\n                             backgroundColor: \"#fff\",\r\n                             padding: \"15px\",\r\n@@ -194,24 +122,17 @@\n                             display: \"flex\",\r\n                             flexDirection: \"column\",\r\n                         }}\r\n                     >\r\n-                        {showEditUser && (\r\n-                            <EditUser\r\n-                                isEditing={isEditing}\r\n-                                user={userToEdit}\r\n-                                onClose={() => setShowEditUser(false)}\r\n-                                onSave={handleSaveUser}\r\n-                            />\r\n-                        )}\r\n-\r\n-\r\n+                        <EditUser\r\n+                            isEditing={isEditing}\r\n+                            user={userToEdit}\r\n+                            onClose={() => setShowEditUser(false)}\r\n+                            onSave={handleSaveUser}\r\n+                        />\r\n                     </Box>\r\n                 </Modal>\r\n             )}\r\n-\r\n-\r\n-\r\n         </>\r\n     );\r\n };\r\n \r\n"
                },
                {
                    "date": 1740742319462,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -59,8 +59,13 @@\n         }\r\n         setShowEditUser(false);\r\n     };\r\n \r\n+    const filteredData = data.filter(user => \r\n+        user.name.toLowerCase().includes(searchQuery.toLowerCase())\r\n+    );\r\n+    \r\n+\r\n     return (\r\n         <>\r\n             <Box\r\n                 sx={{\r\n"
                },
                {
                    "date": 1740742341830,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -87,9 +87,9 @@\n                         onChange={(e) => setSearchQuery(e.target.value)}\r\n                     />\r\n                     <button className=\"blue-button\" onClick={handleAddNewUser}>เพิ่มผู้ใช้ใหม่</button>\r\n                 </div>\r\n-                <UserTable data={data} roleOptions={roleOptions} onEdit={handleEditUser} />\r\n+                <UserTable data={filteredData} roleOptions={roleOptions} onEdit={handleEditUser} />\r\n             </Box>\r\n \r\n             {!isMobile && showEditUser && (\r\n                 <Box\r\n"
                },
                {
                    "date": 1740818094360,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -62,9 +62,10 @@\n \r\n     const filteredData = data.filter(user => \r\n         user.name.toLowerCase().includes(searchQuery.toLowerCase())\r\n     );\r\n-    \r\n+    console.log(\"Role ที่มีในระบบ\", roleOptions)\r\n+    console.log(\"ข้อมูลของ User\", filteredData)\r\n \r\n     return (\r\n         <>\r\n             <Box\r\n"
                },
                {
                    "date": 1740818229774,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -62,10 +62,8 @@\n \r\n     const filteredData = data.filter(user => \r\n         user.name.toLowerCase().includes(searchQuery.toLowerCase())\r\n     );\r\n-    console.log(\"Role ที่มีในระบบ\", roleOptions)\r\n-    console.log(\"ข้อมูลของ User\", filteredData)\r\n \r\n     return (\r\n         <>\r\n             <Box\r\n"
                },
                {
                    "date": 1740818764707,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -49,9 +49,13 @@\n \r\n     const handleSaveUser = (updatedUser) => {\r\n         if (isEditing) {\r\n             axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n-                .then(res => setData(data.map(user => (user._id === res.data._id ? res.data : user))))\r\n+                .then(res =>\r\n+                    console.log(res) \r\n+                    setData(\r\n+                        data.map(user => (user._id === res.data._id ? res.data : user))\r\n+                    ))\r\n                 .catch(err => console.error('Failed to update user:', err));\r\n         } else {\r\n             axios.post('http://localhost:5000/api/users', updatedUser)\r\n                 .then(res => setData([...data, res.data]))\r\n"
                },
                {
                    "date": 1740818793233,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -49,13 +49,13 @@\n \r\n     const handleSaveUser = (updatedUser) => {\r\n         if (isEditing) {\r\n             axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n-                .then(res =>\r\n+                .then(res =>(\r\n                     console.log(res) \r\n                     setData(\r\n                         data.map(user => (user._id === res.data._id ? res.data : user))\r\n-                    ))\r\n+                    )))\r\n                 .catch(err => console.error('Failed to update user:', err));\r\n         } else {\r\n             axios.post('http://localhost:5000/api/users', updatedUser)\r\n                 .then(res => setData([...data, res.data]))\r\n"
                },
                {
                    "date": 1740818824065,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -49,13 +49,11 @@\n \r\n     const handleSaveUser = (updatedUser) => {\r\n         if (isEditing) {\r\n             axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n-                .then(res =>(\r\n+                .then(res =>\r\n                     console.log(res) \r\n-                    setData(\r\n-                        data.map(user => (user._id === res.data._id ? res.data : user))\r\n-                    )))\r\n+                    setData(data.map(user => (user._id === res.data._id ? res.data : user))))\r\n                 .catch(err => console.error('Failed to update user:', err));\r\n         } else {\r\n             axios.post('http://localhost:5000/api/users', updatedUser)\r\n                 .then(res => setData([...data, res.data]))\r\n"
                },
                {
                    "date": 1740818839906,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -49,11 +49,11 @@\n \r\n     const handleSaveUser = (updatedUser) => {\r\n         if (isEditing) {\r\n             axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n-                .then(res =>\r\n-                    console.log(res) \r\n-                    setData(data.map(user => (user._id === res.data._id ? res.data : user))))\r\n+                .then(res => {\r\n+                    setData(data.map(user => (user._id === res.data._id ? res.data : user)))\r\n+                })\r\n                 .catch(err => console.error('Failed to update user:', err));\r\n         } else {\r\n             axios.post('http://localhost:5000/api/users', updatedUser)\r\n                 .then(res => setData([...data, res.data]))\r\n"
                },
                {
                    "date": 1740818851285,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,8 @@\n import '../IngredientManager/IngredientManager.css';\r\n import EditUser from './assets/EditUser';\r\n import UserTable from './assets/UserTable';\r\n import axios from 'axios';\r\n-import Swal from 'sweetalert2';\r\n import { Box, useMediaQuery, Modal } from \"@mui/material\";\r\n \r\n const UserManager = () => {\r\n     const isMobile = useMediaQuery(\"(max-width: 767px)\");\r\n"
                },
                {
                    "date": 1740818874676,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -49,8 +49,9 @@\n     const handleSaveUser = (updatedUser) => {\r\n         if (isEditing) {\r\n             axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n                 .then(res => {\r\n+                    console.log(res)\r\n                     setData(data.map(user => (user._id === res.data._id ? res.data : user)))\r\n                 })\r\n                 .catch(err => console.error('Failed to update user:', err));\r\n         } else {\r\n"
                },
                {
                    "date": 1740818902689,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,8 +20,10 @@\n     useEffect(() => {\r\n         const fetchData = async () => {\r\n             try {\r\n                 const response = await axios.get('http://localhost:5000/api/users');\r\n+                console.log(res)\r\n+\r\n                 setData(response.data);\r\n             } catch (err) {\r\n                 console.error('Failed to fetch users:', err);\r\n             }\r\n"
                },
                {
                    "date": 1740818908185,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,10 +20,9 @@\n     useEffect(() => {\r\n         const fetchData = async () => {\r\n             try {\r\n                 const response = await axios.get('http://localhost:5000/api/users');\r\n-                console.log(res)\r\n-\r\n+                console.log(response)\r\n                 setData(response.data);\r\n             } catch (err) {\r\n                 console.error('Failed to fetch users:', err);\r\n             }\r\n"
                },
                {
                    "date": 1740824010662,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,9 +20,9 @@\n     useEffect(() => {\r\n         const fetchData = async () => {\r\n             try {\r\n                 const response = await axios.get('http://localhost:5000/api/users');\r\n-                console.log(response)\r\n+                console.log(response.data)\r\n                 setData(response.data);\r\n             } catch (err) {\r\n                 console.error('Failed to fetch users:', err);\r\n             }\r\n@@ -62,8 +62,34 @@\n         }\r\n         setShowEditUser(false);\r\n     };\r\n \r\n+    const handleClickConfirm = (userId) => {\r\n+        Swal.fire({\r\n+            title: \"คุณแน่ใจหรือไม่?\",\r\n+            text: \"เมื่อลบแล้วจะไม่สามารถกู้คืนได้!\",\r\n+            icon: \"warning\",\r\n+            showCancelButton: true,\r\n+            confirmButtonColor: \"#d33\",\r\n+            cancelButtonColor: \"#3085d6\",\r\n+            confirmButtonText: \"ใช่, ลบเลย!\",\r\n+            cancelButtonText: \"ยกเลิก\"\r\n+        }).then((result) => {\r\n+            if (result.isConfirmed) {\r\n+                axios.delete(`http://localhost:5000/api/users/${userId}`)\r\n+                    .then(() => {\r\n+                        setData(data.filter(user => user._id !== userId));\r\n+                        Swal.fire(\"ลบสำเร็จ!\", \"ผู้ใช้ถูกลบออกจากระบบ\", \"success\");\r\n+                    })\r\n+                    .catch(err => {\r\n+                        console.error('Failed to delete user:', err);\r\n+                        Swal.fire(\"เกิดข้อผิดพลาด!\", \"ไม่สามารถลบผู้ใช้ได้\", \"error\");\r\n+                    });\r\n+            }\r\n+        });\r\n+    };\r\n+    \r\n+\r\n     const filteredData = data.filter(user => \r\n         user.name.toLowerCase().includes(searchQuery.toLowerCase())\r\n     );\r\n \r\n"
                },
                {
                    "date": 1740824023364,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -62,9 +62,9 @@\n         }\r\n         setShowEditUser(false);\r\n     };\r\n \r\n-    const handleClickConfirm = (userId) => {\r\n+    const handleClickConfirm = (user) => {\r\n         Swal.fire({\r\n             title: \"คุณแน่ใจหรือไม่?\",\r\n             text: \"เมื่อลบแล้วจะไม่สามารถกู้คืนได้!\",\r\n             icon: \"warning\",\r\n@@ -74,11 +74,11 @@\n             confirmButtonText: \"ใช่, ลบเลย!\",\r\n             cancelButtonText: \"ยกเลิก\"\r\n         }).then((result) => {\r\n             if (result.isConfirmed) {\r\n-                axios.delete(`http://localhost:5000/api/users/${userId}`)\r\n+                axios.delete(`http://localhost:5000/api/users/${user}`)\r\n                     .then(() => {\r\n-                        setData(data.filter(user => user._id !== userId));\r\n+                        setData(data.filter(user => user._id !== user));\r\n                         Swal.fire(\"ลบสำเร็จ!\", \"ผู้ใช้ถูกลบออกจากระบบ\", \"success\");\r\n                     })\r\n                     .catch(err => {\r\n                         console.error('Failed to delete user:', err);\r\n"
                },
                {
                    "date": 1740824044458,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -68,10 +68,10 @@\n             title: \"คุณแน่ใจหรือไม่?\",\r\n             text: \"เมื่อลบแล้วจะไม่สามารถกู้คืนได้!\",\r\n             icon: \"warning\",\r\n             showCancelButton: true,\r\n-            confirmButtonColor: \"#d33\",\r\n-            cancelButtonColor: \"#3085d6\",\r\n+            confirmButtonColor: \"#ff7878\",\r\n+            cancelButtonColor: \"#B2B2B2\",\r\n             confirmButtonText: \"ใช่, ลบเลย!\",\r\n             cancelButtonText: \"ยกเลิก\"\r\n         }).then((result) => {\r\n             if (result.isConfirmed) {\r\n"
                },
                {
                    "date": 1740824057685,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,8 +3,9 @@\n import '../IngredientManager/IngredientManager.css';\r\n import EditUser from './assets/EditUser';\r\n import UserTable from './assets/UserTable';\r\n import axios from 'axios';\r\n+import Swal from 'sweetalert2';\r\n import { Box, useMediaQuery, Modal } from \"@mui/material\";\r\n \r\n const UserManager = () => {\r\n     const isMobile = useMediaQuery(\"(max-width: 767px)\");\r\n"
                },
                {
                    "date": 1740824103442,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -63,9 +63,9 @@\n         }\r\n         setShowEditUser(false);\r\n     };\r\n \r\n-    const handleClickConfirm = (user) => {\r\n+    const handleDeleteUser = (user) => {\r\n         Swal.fire({\r\n             title: \"คุณแน่ใจหรือไม่?\",\r\n             text: \"เมื่อลบแล้วจะไม่สามารถกู้คืนได้!\",\r\n             icon: \"warning\",\r\n@@ -116,9 +116,9 @@\n                         onChange={(e) => setSearchQuery(e.target.value)}\r\n                     />\r\n                     <button className=\"blue-button\" onClick={handleAddNewUser}>เพิ่มผู้ใช้ใหม่</button>\r\n                 </div>\r\n-                <UserTable data={filteredData} roleOptions={roleOptions} onEdit={handleEditUser} />\r\n+                <UserTable data={filteredData} roleOptions={roleOptions} onEdit={handleEditUser} onClick={handleDeleteUser}/>\r\n             </Box>\r\n \r\n             {!isMobile && showEditUser && (\r\n                 <Box\r\n"
                },
                {
                    "date": 1740824265786,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -75,9 +75,9 @@\n             confirmButtonText: \"ใช่, ลบเลย!\",\r\n             cancelButtonText: \"ยกเลิก\"\r\n         }).then((result) => {\r\n             if (result.isConfirmed) {\r\n-                axios.delete(`http://localhost:5000/api/users/${user}`)\r\n+                axios.delete(`http://localhost:5000/api/users/${user._id}`)\r\n                     .then(() => {\r\n                         setData(data.filter(user => user._id !== user));\r\n                         Swal.fire(\"ลบสำเร็จ!\", \"ผู้ใช้ถูกลบออกจากระบบ\", \"success\");\r\n                     })\r\n"
                },
                {
                    "date": 1740824292798,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -21,9 +21,8 @@\n     useEffect(() => {\r\n         const fetchData = async () => {\r\n             try {\r\n                 const response = await axios.get('http://localhost:5000/api/users');\r\n-                console.log(response.data)\r\n                 setData(response.data);\r\n             } catch (err) {\r\n                 console.error('Failed to fetch users:', err);\r\n             }\r\n@@ -32,9 +31,9 @@\n \r\n         axios.get('http://localhost:5000/api/roles')\r\n             .then(res => setRoleOptions(res.data))\r\n             .catch(err => console.error('Error fetching roles:', err));\r\n-    }, []);\r\n+    }, [data]);\r\n \r\n     const handleEditUser = (user) => {\r\n         setUserToEdit(user);\r\n         setIsEditing(true);\r\n"
                },
                {
                    "date": 1740824354997,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,18 +18,11 @@\n     const [isEditing, setIsEditing] = useState(false);\r\n     const [roleOptions, setRoleOptions] = useState([]);\r\n \r\n     useEffect(() => {\r\n-        const fetchData = async () => {\r\n-            try {\r\n-                const response = await axios.get('http://localhost:5000/api/users');\r\n-                setData(response.data);\r\n-            } catch (err) {\r\n-                console.error('Failed to fetch users:', err);\r\n-            }\r\n-        };\r\n-        fetchData();\r\n-\r\n+        axios.get('http://localhost:5000/api/users')\r\n+            .then(res => setData(response.data))\r\n+            .catch(err => console.error('Error fetching roles:', err));\r\n         axios.get('http://localhost:5000/api/roles')\r\n             .then(res => setRoleOptions(res.data))\r\n             .catch(err => console.error('Error fetching roles:', err));\r\n     }, [data]);\r\n"
                },
                {
                    "date": 1740824369392,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,9 +19,9 @@\n     const [roleOptions, setRoleOptions] = useState([]);\r\n \r\n     useEffect(() => {\r\n         axios.get('http://localhost:5000/api/users')\r\n-            .then(res => setData(response.data))\r\n+            .then(res => setData(res.data))\r\n             .catch(err => console.error('Error fetching roles:', err));\r\n         axios.get('http://localhost:5000/api/roles')\r\n             .then(res => setRoleOptions(res.data))\r\n             .catch(err => console.error('Error fetching roles:', err));\r\n"
                },
                {
                    "date": 1740827099345,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,8 +18,14 @@\n     const [isEditing, setIsEditing] = useState(false);\r\n     const [roleOptions, setRoleOptions] = useState([]);\r\n \r\n     useEffect(() => {\r\n+        const token = localStorage.getItem(\"token\");\r\n+        if (!token) {\r\n+            Swal.fire({title: \"Sesstion ของคุณหมดอายุ\", text: \"กรุณาเข้าสู่ระบบใหม่\", icon: \"warning\", confirmButtonColor: \"#64A2FF\", confirmButtonText: \"OK\"})\r\n+                .then(() => {navigate('/');});\r\n+            return;\r\n+        }\r\n         axios.get('http://localhost:5000/api/users')\r\n             .then(res => setData(res.data))\r\n             .catch(err => console.error('Error fetching roles:', err));\r\n         axios.get('http://localhost:5000/api/roles')\r\n"
                },
                {
                    "date": 1740827136269,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -5,12 +5,14 @@\n import UserTable from './assets/UserTable';\r\n import axios from 'axios';\r\n import Swal from 'sweetalert2';\r\n import { Box, useMediaQuery, Modal } from \"@mui/material\";\r\n+import { useNavigate } from 'react-router-dom';\r\n \r\n const UserManager = () => {\r\n     const isMobile = useMediaQuery(\"(max-width: 767px)\");\r\n     const isTablet = useMediaQuery(\"(min-width: 768px) and (max-width: 1040px)\");\r\n+    const navigate = useNavigate();\r\n \r\n     const [data, setData] = useState([]);\r\n     const [searchQuery, setSearchQuery] = useState('');\r\n     const [showEditUser, setShowEditUser] = useState(false);\r\n"
                },
                {
                    "date": 1740831412759,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -87,9 +87,8 @@\n                     });\r\n             }\r\n         });\r\n     };\r\n-    \r\n \r\n     const filteredData = data.filter(user => \r\n         user.name.toLowerCase().includes(searchQuery.toLowerCase())\r\n     );\r\n"
                },
                {
                    "date": 1740831690656,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,175 @@\n+import React, { useState, useEffect } from 'react';\r\n+import './UserManager.css';\r\n+import '../IngredientManager/IngredientManager.css';\r\n+import EditUser from './assets/EditUser';\r\n+import UserTable from './assets/UserTable';\r\n+import axios from 'axios';\r\n+import Swal from 'sweetalert2';\r\n+import { Box, useMediaQuery, Modal } from \"@mui/material\";\r\n+import { useNavigate } from 'react-router-dom';\r\n+\r\n+const UserManager = () => {\r\n+    const isMobile = useMediaQuery(\"(max-width: 767px)\");\r\n+    const isTablet = useMediaQuery(\"(min-width: 768px) and (max-width: 1040px)\");\r\n+    const navigate = useNavigate();\r\n+\r\n+    const [data, setData] = useState([]);\r\n+    const [searchQuery, setSearchQuery] = useState('');\r\n+    const [showEditUser, setShowEditUser] = useState(false);\r\n+    const [userToEdit, setUserToEdit] = useState(null);\r\n+    const [isEditing, setIsEditing] = useState(false);\r\n+    const [roleOptions, setRoleOptions] = useState([]);\r\n+\r\n+    useEffect(() => {\r\n+        const token = localStorage.getItem(\"token\");\r\n+        if (!token) {\r\n+            Swal.fire({title: \"Sesstion ของคุณหมดอายุ\", text: \"กรุณาเข้าสู่ระบบใหม่\", icon: \"warning\", confirmButtonColor: \"#64A2FF\", confirmButtonText: \"OK\"})\r\n+                .then(() => {navigate('/');});\r\n+            return;\r\n+        }\r\n+        axios.get('http://localhost:5000/api/users')\r\n+            .then(res => setData(res.data))\r\n+            .catch(err => console.error('Error fetching roles:', err));\r\n+        axios.get('http://localhost:5000/api/roles')\r\n+            .then(res => setRoleOptions(res.data))\r\n+            .catch(err => console.error('Error fetching roles:', err));\r\n+    }, [data]);\r\n+\r\n+    const handleEditUser = (user) => {\r\n+        setUserToEdit(user);\r\n+        setIsEditing(true);\r\n+        setShowEditUser(true);\r\n+    };\r\n+\r\n+    const handleAddNewUser = () => {\r\n+        setUserToEdit({ id: '', name: '', nickname: '', roll: '', phone: '' });\r\n+        setIsEditing(false);\r\n+        setShowEditUser(true);\r\n+        console.log(\"เปิด Modal:\", showEditUser);\r\n+    };\r\n+\r\n+    const handleSaveUser = (updatedUser) => {\r\n+        try {\r\n+            let response;\r\n+            if (isEditing) {\r\n+                response = await axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser);\r\n+                setData(data.map(user => (user._id === response.data._id ? response.data : user)));\r\n+            } else {\r\n+                response = await axios.post('http://localhost:5000/api/users', updatedUser);\r\n+                setData([...data, response.data]);\r\n+            }\r\n+    \r\n+            setShowEditUser(false);\r\n+            return response.data; // ส่งข้อมูลกลับไปยัง `handleSave()`\r\n+        } catch (error) {\r\n+            console.error(\"Failed to save user:\", error);\r\n+            throw error; // โยน error ออกไปให้ `handleSave()` จับ\r\n+        }\r\n+    };\r\n+\r\n+    const handleDeleteUser = (user) => {\r\n+        Swal.fire({\r\n+            title: \"คุณแน่ใจหรือไม่?\",\r\n+            text: \"เมื่อลบแล้วจะไม่สามารถกู้คืนได้!\",\r\n+            icon: \"warning\",\r\n+            showCancelButton: true,\r\n+            confirmButtonColor: \"#ff7878\",\r\n+            cancelButtonColor: \"#B2B2B2\",\r\n+            confirmButtonText: \"ใช่, ลบเลย!\",\r\n+            cancelButtonText: \"ยกเลิก\"\r\n+        }).then((result) => {\r\n+            if (result.isConfirmed) {\r\n+                axios.delete(`http://localhost:5000/api/users/${user._id}`)\r\n+                    .then(() => {\r\n+                        setData(data.filter(user => user._id !== user));\r\n+                        Swal.fire(\"ลบสำเร็จ!\", \"ผู้ใช้ถูกลบออกจากระบบ\", \"success\");\r\n+                    })\r\n+                    .catch(err => {\r\n+                        console.error('Failed to delete user:', err);\r\n+                        Swal.fire(\"เกิดข้อผิดพลาด!\", \"ไม่สามารถลบผู้ใช้ได้\", \"error\");\r\n+                    });\r\n+            }\r\n+        });\r\n+    };\r\n+\r\n+    const filteredData = data.filter(user => \r\n+        user.name.toLowerCase().includes(searchQuery.toLowerCase())\r\n+    );\r\n+\r\n+    return (\r\n+        <>\r\n+            <Box\r\n+                sx={{\r\n+                    backgroundColor: \"#fff\",\r\n+                    width: isMobile ? \"100%\" : isTablet ? \"65%\" : \"75%\",\r\n+                    height: \"100vh\",\r\n+                    padding: \"20px\",\r\n+                    borderRadius: \"8px\",\r\n+                    overflowY: \"auto\",\r\n+                    marginRight: \"10px\"\r\n+                }}\r\n+            >\r\n+                <div className=\"search-container\">\r\n+                    <input\r\n+                        type=\"text\"\r\n+                        className=\"search-input\"\r\n+                        placeholder=\"ค้นหาด้วยชื่อ เช่น น้องแก้ม เฟื่อง\"\r\n+                        value={searchQuery}\r\n+                        onChange={(e) => setSearchQuery(e.target.value)}\r\n+                    />\r\n+                    <button className=\"blue-button\" onClick={handleAddNewUser}>เพิ่มผู้ใช้ใหม่</button>\r\n+                </div>\r\n+                <UserTable data={filteredData} roleOptions={roleOptions} onEdit={handleEditUser} onClick={handleDeleteUser}/>\r\n+            </Box>\r\n+\r\n+            {!isMobile && showEditUser && (\r\n+                <Box\r\n+                    sx={{\r\n+                        backgroundColor: \"#fff\",\r\n+                        width: isTablet ? \"35%\" : \"25%\",\r\n+                        height: \"100vh\",\r\n+                        padding: \"20px\",\r\n+                        borderRadius: \"8px\",\r\n+                        overflowY: \"auto\",\r\n+                        display: \"flex\",\r\n+                        flexDirection: \"column\",\r\n+                    }}\r\n+                >\r\n+                    <EditUser\r\n+                        isEditing={isEditing}\r\n+                        user={userToEdit}\r\n+                        onClose={() => setShowEditUser(false)}\r\n+                        onSave={handleSaveUser}\r\n+                    />\r\n+                </Box>\r\n+            )}\r\n+\r\n+            {isMobile && (\r\n+                <Modal open={showEditUser} onClose={() => setShowEditUser(false)}>\r\n+                    <Box\r\n+                        sx={{\r\n+                            backgroundColor: \"#fff\",\r\n+                            padding: \"15px\",\r\n+                            borderRadius: \"8px\",\r\n+                            maxWidth: \"90vw\",\r\n+                            height: \"80vh\",\r\n+                            margin: \"10vh auto\",\r\n+                            overflowY: \"auto\",\r\n+                            display: \"flex\",\r\n+                            flexDirection: \"column\",\r\n+                        }}\r\n+                    >\r\n+                        <EditUser\r\n+                            isEditing={isEditing}\r\n+                            user={userToEdit}\r\n+                            onClose={() => setShowEditUser(false)}\r\n+                            onSave={handleSaveUser}\r\n+                        />\r\n+                    </Box>\r\n+                </Modal>\r\n+            )}\r\n+        </>\r\n+    );\r\n+};\r\n+\r\n+export default UserManager;\r\n"
                },
                {
                    "date": 1740831707302,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -48,183 +48,8 @@\n         console.log(\"เปิด Modal:\", showEditUser);\r\n     };\r\n \r\n     const handleSaveUser = (updatedUser) => {\r\n-        try {\r\n-            let response;\r\n-            if (isEditing) {\r\n-                response = await axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser);\r\n-                setData(data.map(user => (user._id === response.data._id ? response.data : user)));\r\n-            } else {\r\n-                response = await axios.post('http://localhost:5000/api/users', updatedUser);\r\n-                setData([...data, response.data]);\r\n-            }\r\n-    \r\n-            setShowEditUser(false);\r\n-            return response.data; // ส่งข้อมูลกลับไปยัง `handleSave()`\r\n-        } catch (error) {\r\n-            console.error(\"Failed to save user:\", error);\r\n-            throw error; // โยน error ออกไปให้ `handleSave()` จับ\r\n-        }\r\n-    };\r\n-\r\n-    const handleDeleteUser = (user) => {\r\n-        Swal.fire({\r\n-            title: \"คุณแน่ใจหรือไม่?\",\r\n-            text: \"เมื่อลบแล้วจะไม่สามารถกู้คืนได้!\",\r\n-            icon: \"warning\",\r\n-            showCancelButton: true,\r\n-            confirmButtonColor: \"#ff7878\",\r\n-            cancelButtonColor: \"#B2B2B2\",\r\n-            confirmButtonText: \"ใช่, ลบเลย!\",\r\n-            cancelButtonText: \"ยกเลิก\"\r\n-        }).then((result) => {\r\n-            if (result.isConfirmed) {\r\n-                axios.delete(`http://localhost:5000/api/users/${user._id}`)\r\n-                    .then(() => {\r\n-                        setData(data.filter(user => user._id !== user));\r\n-                        Swal.fire(\"ลบสำเร็จ!\", \"ผู้ใช้ถูกลบออกจากระบบ\", \"success\");\r\n-                    })\r\n-                    .catch(err => {\r\n-                        console.error('Failed to delete user:', err);\r\n-                        Swal.fire(\"เกิดข้อผิดพลาด!\", \"ไม่สามารถลบผู้ใช้ได้\", \"error\");\r\n-                    });\r\n-            }\r\n-        });\r\n-    };\r\n-\r\n-    const filteredData = data.filter(user => \r\n-        user.name.toLowerCase().includes(searchQuery.toLowerCase())\r\n-    );\r\n-\r\n-    return (\r\n-        <>\r\n-            <Box\r\n-                sx={{\r\n-                    backgroundColor: \"#fff\",\r\n-                    width: isMobile ? \"100%\" : isTablet ? \"65%\" : \"75%\",\r\n-                    height: \"100vh\",\r\n-                    padding: \"20px\",\r\n-                    borderRadius: \"8px\",\r\n-                    overflowY: \"auto\",\r\n-                    marginRight: \"10px\"\r\n-                }}\r\n-            >\r\n-                <div className=\"search-container\">\r\n-                    <input\r\n-                        type=\"text\"\r\n-                        className=\"search-input\"\r\n-                        placeholder=\"ค้นหาด้วยชื่อ เช่น น้องแก้ม เฟื่อง\"\r\n-                        value={searchQuery}\r\n-                        onChange={(e) => setSearchQuery(e.target.value)}\r\n-                    />\r\n-                    <button className=\"blue-button\" onClick={handleAddNewUser}>เพิ่มผู้ใช้ใหม่</button>\r\n-                </div>\r\n-                <UserTable data={filteredData} roleOptions={roleOptions} onEdit={handleEditUser} onClick={handleDeleteUser}/>\r\n-            </Box>\r\n-\r\n-            {!isMobile && showEditUser && (\r\n-                <Box\r\n-                    sx={{\r\n-                        backgroundColor: \"#fff\",\r\n-                        width: isTablet ? \"35%\" : \"25%\",\r\n-                        height: \"100vh\",\r\n-                        padding: \"20px\",\r\n-                        borderRadius: \"8px\",\r\n-                        overflowY: \"auto\",\r\n-                        display: \"flex\",\r\n-                        flexDirection: \"column\",\r\n-                    }}\r\n-                >\r\n-                    <EditUser\r\n-                        isEditing={isEditing}\r\n-                        user={userToEdit}\r\n-                        onClose={() => setShowEditUser(false)}\r\n-                        onSave={handleSaveUser}\r\n-                    />\r\n-                </Box>\r\n-            )}\r\n-\r\n-            {isMobile && (\r\n-                <Modal open={showEditUser} onClose={() => setShowEditUser(false)}>\r\n-                    <Box\r\n-                        sx={{\r\n-                            backgroundColor: \"#fff\",\r\n-                            padding: \"15px\",\r\n-                            borderRadius: \"8px\",\r\n-                            maxWidth: \"90vw\",\r\n-                            height: \"80vh\",\r\n-                            margin: \"10vh auto\",\r\n-                            overflowY: \"auto\",\r\n-                            display: \"flex\",\r\n-                            flexDirection: \"column\",\r\n-                        }}\r\n-                    >\r\n-                        <EditUser\r\n-                            isEditing={isEditing}\r\n-                            user={userToEdit}\r\n-                            onClose={() => setShowEditUser(false)}\r\n-                            onSave={handleSaveUser}\r\n-                        />\r\n-                    </Box>\r\n-                </Modal>\r\n-            )}\r\n-        </>\r\n-    );\r\n-};\r\n-\r\n-export default UserManager;\r\n-import React, { useState, useEffect } from 'react';\r\n-import './UserManager.css';\r\n-import '../IngredientManager/IngredientManager.css';\r\n-import EditUser from './assets/EditUser';\r\n-import UserTable from './assets/UserTable';\r\n-import axios from 'axios';\r\n-import Swal from 'sweetalert2';\r\n-import { Box, useMediaQuery, Modal } from \"@mui/material\";\r\n-import { useNavigate } from 'react-router-dom';\r\n-\r\n-const UserManager = () => {\r\n-    const isMobile = useMediaQuery(\"(max-width: 767px)\");\r\n-    const isTablet = useMediaQuery(\"(min-width: 768px) and (max-width: 1040px)\");\r\n-    const navigate = useNavigate();\r\n-\r\n-    const [data, setData] = useState([]);\r\n-    const [searchQuery, setSearchQuery] = useState('');\r\n-    const [showEditUser, setShowEditUser] = useState(false);\r\n-    const [userToEdit, setUserToEdit] = useState(null);\r\n-    const [isEditing, setIsEditing] = useState(false);\r\n-    const [roleOptions, setRoleOptions] = useState([]);\r\n-\r\n-    useEffect(() => {\r\n-        const token = localStorage.getItem(\"token\");\r\n-        if (!token) {\r\n-            Swal.fire({title: \"Sesstion ของคุณหมดอายุ\", text: \"กรุณาเข้าสู่ระบบใหม่\", icon: \"warning\", confirmButtonColor: \"#64A2FF\", confirmButtonText: \"OK\"})\r\n-                .then(() => {navigate('/');});\r\n-            return;\r\n-        }\r\n-        axios.get('http://localhost:5000/api/users')\r\n-            .then(res => setData(res.data))\r\n-            .catch(err => console.error('Error fetching roles:', err));\r\n-        axios.get('http://localhost:5000/api/roles')\r\n-            .then(res => setRoleOptions(res.data))\r\n-            .catch(err => console.error('Error fetching roles:', err));\r\n-    }, [data]);\r\n-\r\n-    const handleEditUser = (user) => {\r\n-        setUserToEdit(user);\r\n-        setIsEditing(true);\r\n-        setShowEditUser(true);\r\n-    };\r\n-\r\n-    const handleAddNewUser = () => {\r\n-        setUserToEdit({ id: '', name: '', nickname: '', roll: '', phone: '' });\r\n-        setIsEditing(false);\r\n-        setShowEditUser(true);\r\n-        console.log(\"เปิด Modal:\", showEditUser);\r\n-    };\r\n-\r\n-    const handleSaveUser = (updatedUser) => {\r\n         if (isEditing) {\r\n             axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n                 .then(res => {\r\n                     console.log(res)\r\n@@ -236,8 +61,9 @@\n                 .then(res => setData([...data, res.data]))\r\n                 .catch(err => console.error('Failed to add user:', err));\r\n         }\r\n         setShowEditUser(false);\r\n+        return response.data;\r\n     };\r\n \r\n     const handleDeleteUser = (user) => {\r\n         Swal.fire({\r\n"
                },
                {
                    "date": 1740831751281,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -48,23 +48,43 @@\n         console.log(\"เปิด Modal:\", showEditUser);\r\n     };\r\n \r\n     const handleSaveUser = (updatedUser) => {\r\n+        let request;\r\n+    \r\n         if (isEditing) {\r\n-            axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n-                .then(res => {\r\n-                    console.log(res)\r\n-                    setData(data.map(user => (user._id === res.data._id ? res.data : user)))\r\n-                })\r\n-                .catch(err => console.error('Failed to update user:', err));\r\n+            request = axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser);\r\n         } else {\r\n-            axios.post('http://localhost:5000/api/users', updatedUser)\r\n-                .then(res => setData([...data, res.data]))\r\n-                .catch(err => console.error('Failed to add user:', err));\r\n+            request = axios.post('http://localhost:5000/api/users', updatedUser);\r\n         }\r\n-        setShowEditUser(false);\r\n-        return response.data;\r\n+    \r\n+        request\r\n+            .then(res => {\r\n+                if (isEditing) {\r\n+                    setData(data.map(user => (user._id === res.data._id ? res.data : user)));\r\n+                } else {\r\n+                    setData([...data, res.data]);\r\n+                }\r\n+    \r\n+                // ✅ ปิดฟอร์มหลังจากบันทึกสำเร็จ\r\n+                setShowEditUser(false);\r\n+            })\r\n+            .catch(err => {\r\n+                console.error('Failed to save user:', err);\r\n+    \r\n+                let errorMessage = \"เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง\";\r\n+                if (err.response && err.response.data && err.response.data.error) {\r\n+                    errorMessage = err.response.data.error;\r\n+                }\r\n+    \r\n+                Swal.fire({\r\n+                    icon: \"error\",\r\n+                    title: errorMessage,\r\n+                    confirmButtonText: \"ตกลง\"\r\n+                });\r\n+            });\r\n     };\r\n+    \r\n \r\n     const handleDeleteUser = (user) => {\r\n         Swal.fire({\r\n             title: \"คุณแน่ใจหรือไม่?\",\r\n"
                },
                {
                    "date": 1740831757062,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -63,10 +63,9 @@\n                     setData(data.map(user => (user._id === res.data._id ? res.data : user)));\r\n                 } else {\r\n                     setData([...data, res.data]);\r\n                 }\r\n-    \r\n-                // ✅ ปิดฟอร์มหลังจากบันทึกสำเร็จ\r\n+\r\n                 setShowEditUser(false);\r\n             })\r\n             .catch(err => {\r\n                 console.error('Failed to save user:', err);\r\n"
                },
                {
                    "date": 1740831785476,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -67,10 +67,8 @@\n \r\n                 setShowEditUser(false);\r\n             })\r\n             .catch(err => {\r\n-                console.error('Failed to save user:', err);\r\n-    \r\n                 let errorMessage = \"เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง\";\r\n                 if (err.response && err.response.data && err.response.data.error) {\r\n                     errorMessage = err.response.data.error;\r\n                 }\r\n"
                },
                {
                    "date": 1740831791084,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -63,17 +63,15 @@\n                     setData(data.map(user => (user._id === res.data._id ? res.data : user)));\r\n                 } else {\r\n                     setData([...data, res.data]);\r\n                 }\r\n-\r\n                 setShowEditUser(false);\r\n             })\r\n             .catch(err => {\r\n                 let errorMessage = \"เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง\";\r\n                 if (err.response && err.response.data && err.response.data.error) {\r\n                     errorMessage = err.response.data.error;\r\n                 }\r\n-    \r\n                 Swal.fire({\r\n                     icon: \"error\",\r\n                     title: errorMessage,\r\n                     confirmButtonText: \"ตกลง\"\r\n"
                },
                {
                    "date": 1740831897178,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -63,23 +63,38 @@\n                     setData(data.map(user => (user._id === res.data._id ? res.data : user)));\r\n                 } else {\r\n                     setData([...data, res.data]);\r\n                 }\r\n+    \r\n+                // ✅ แจ้งเตือนเมื่อบันทึกสำเร็จ\r\n+                Swal.fire({\r\n+                    icon: \"success\",\r\n+                    title: \"บันทึกข้อมูลสำเร็จ!\",\r\n+                    showConfirmButton: false,\r\n+                    timer: 1500\r\n+                });\r\n+    \r\n+                // ✅ ปิดฟอร์มเมื่อบันทึกสำเร็จเท่านั้น\r\n                 setShowEditUser(false);\r\n             })\r\n             .catch(err => {\r\n+                console.error(\"Error:\", err);\r\n+    \r\n                 let errorMessage = \"เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง\";\r\n                 if (err.response && err.response.data && err.response.data.error) {\r\n-                    errorMessage = err.response.data.error;\r\n+                    errorMessage = err.response.data.error; // ใช้ข้อความจาก backend\r\n                 }\r\n+    \r\n+                // ❌ ฟอร์มจะไม่ถูกปิดเมื่อเกิด error\r\n                 Swal.fire({\r\n                     icon: \"error\",\r\n                     title: errorMessage,\r\n                     confirmButtonText: \"ตกลง\"\r\n                 });\r\n             });\r\n     };\r\n     \r\n+    \r\n \r\n     const handleDeleteUser = (user) => {\r\n         Swal.fire({\r\n             title: \"คุณแน่ใจหรือไม่?\",\r\n"
                },
                {
                    "date": 1740831960402,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -63,38 +63,23 @@\n                     setData(data.map(user => (user._id === res.data._id ? res.data : user)));\r\n                 } else {\r\n                     setData([...data, res.data]);\r\n                 }\r\n-    \r\n-                // ✅ แจ้งเตือนเมื่อบันทึกสำเร็จ\r\n-                Swal.fire({\r\n-                    icon: \"success\",\r\n-                    title: \"บันทึกข้อมูลสำเร็จ!\",\r\n-                    showConfirmButton: false,\r\n-                    timer: 1500\r\n-                });\r\n-    \r\n-                // ✅ ปิดฟอร์มเมื่อบันทึกสำเร็จเท่านั้น\r\n                 setShowEditUser(false);\r\n             })\r\n             .catch(err => {\r\n-                console.error(\"Error:\", err);\r\n-    \r\n                 let errorMessage = \"เกิดข้อผิดพลาด กรุณาลองใหม่อีกครั้ง\";\r\n                 if (err.response && err.response.data && err.response.data.error) {\r\n-                    errorMessage = err.response.data.error; // ใช้ข้อความจาก backend\r\n+                    errorMessage = err.response.data.error;\r\n                 }\r\n-    \r\n-                // ❌ ฟอร์มจะไม่ถูกปิดเมื่อเกิด error\r\n                 Swal.fire({\r\n                     icon: \"error\",\r\n                     title: errorMessage,\r\n                     confirmButtonText: \"ตกลง\"\r\n                 });\r\n             });\r\n     };\r\n     \r\n-    \r\n \r\n     const handleDeleteUser = (user) => {\r\n         Swal.fire({\r\n             title: \"คุณแน่ใจหรือไม่?\",\r\n"
                },
                {
                    "date": 1740832055066,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -105,9 +105,9 @@\n         });\r\n     };\r\n \r\n     const filteredData = data.filter(user => \r\n-        user.name.toLowerCase().includes(searchQuery.toLowerCase())\r\n+        user.name.includes(searchQuery)\r\n     );\r\n \r\n     return (\r\n         <>\r\n"
                }
            ],
            "date": 1739554088105,
            "name": "Commit-0",
            "content": "import React, { useState, useEffect } from 'react';\r\nimport './UserManager.css';\r\nimport '../IngredientManager/IngredientManager.css';\r\nimport EditUser from './assets/EditUser';\r\nimport UserTable from './assets/UserTable';\r\nimport axios from 'axios';\r\nimport Swal from 'sweetalert2';\r\n\r\nconst UserManager = () => {\r\n    const [data, setData] = useState([]);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [showEditUser, setShowEditUser] = useState(false);\r\n    const [userToEdit, setUserToEdit] = useState(null);\r\n    const [isEditing, setIsEditing] = useState(false);\r\n    const [loading, setLoading] = useState(true);\r\n    const [error, setError] = useState(null);\r\n    const [roleOptions, setRoleOptions] = useState([]);\r\n    const [userToDelete, setUserToDelete] = useState(null);\r\n\r\n    // Fetch data from the API\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            try {\r\n                const response = await axios.get('http://localhost:5000/api/users');\r\n                setData(response.data);\r\n                \r\n            } catch (err) {\r\n                console.error('Failed to fetch users:', err);\r\n                setError('Failed to load user data.');\r\n            } finally {\r\n                setLoading(false);\r\n            }\r\n        };\r\n        fetchData();\r\n\r\n        axios.get('http://localhost:5000/api/roles')\r\n            .then(res => {\r\n                console.log('role จ้า: ', res.data);\r\n                setRoleOptions(res.data); \r\n                \r\n            })\r\n            .catch(err => console.error('Error fetching :', err));\r\n\r\n    }, []);\r\n\r\n    const filteredData = data.filter(item =>\r\n        (item.id && item.id.includes(searchQuery)) || (item.name && item.name.includes(searchQuery))\r\n    );\r\n    \r\n    const handleEditUser = (user) => {\r\n        setUserToEdit(user);\r\n        setIsEditing(true); // Edit user mode\r\n        setShowEditUser(true);\r\n    };\r\n\r\n    const handleAddNewUser = () => {\r\n        setUserToEdit({ id: '', name: '', nickname: '', roll: '', status: 'offline', phone: '' });\r\n        setIsEditing(false); // Add new user mode\r\n        setShowEditUser(true);\r\n    };\r\n\r\n    const handleSaveUser = (updatedUser) => {\r\n        if (isEditing) {\r\n            console.log('แก้ไข user  :', userToEdit._id);\r\n            axios.put(`http://localhost:5000/api/users/${userToEdit._id}`, updatedUser)\r\n                .then(res => {\r\n                    console.log('User updated:', res.data);\r\n                    setData(data.map(user => (user._id === res.data._id ? res.data : user)));\r\n                })\r\n                .catch(err => console.error('Failed to update user:', err));\r\n        } else {\r\n            console.log('เพิ่ม user:', updatedUser);\r\n            axios.post('http://localhost:5000/api/users', updatedUser)\r\n                .then(res => {\r\n                    console.log('User added:', res.data);\r\n                    setData([...data, res.data]);\r\n                })\r\n                .catch(err => console.error('Failed to add user:', err));\r\n        }\r\n        setShowEditUser(false);\r\n    };\r\n\r\n    const handleDeleteUser = (user) => {\r\n        axios.delete(`http://localhost:5000/api/users/${user._id}`)\r\n            .then((res) => {\r\n                Swal.fire({\r\n                    title: 'ผู้ใช้ดังกล่าวถูกลบแล้ว!',\r\n                    icon: 'success',\r\n                    confirmButtonColor: \"#64A2FF\",\r\n                    confirmButtonText: 'OK',\r\n                });\r\n                setData((prevData) => prevData.filter((item) => item._id !== user._id));\r\n            })\r\n            .catch((err) => {\r\n                Swal.fire({\r\n                    title: 'เกิดข้อผิดพลาดในการลบผู้ใช้ดังกล่าว',\r\n                    text: 'ลองใหม่อีกครั้ง',\r\n                    icon: 'error',\r\n                    confirmButtonColor: \"#64A2FF\",\r\n                    confirmButtonText: 'OK',\r\n                });\r\n            });\r\n    };\r\n    \r\n    const handleClickConfirm = (e) => {\r\n        setUserToDelete(e);\r\n        Swal.fire({\r\n            title: 'แน่ใจใช่ไหม?',\r\n            text: `คุณกำลังจะลบผู้ใช้\\nชื่อ: ${e.name}\\nตำแหน่ง: ${roleOptions.find(role => role._id === e.role_id)?.role_name}`,\r\n            icon: 'warning',\r\n            showCancelButton: true,\r\n            confirmButtonColor: \"#ff4b4b\",\r\n            cancelButtonColor: \"#B2B2B2\",\r\n            confirmButtonText: 'ยืนยันการลบ',\r\n            cancelButtonText: 'ยกเลิก',\r\n            dangerMode: true,\r\n        }).then((result) => {\r\n            if (result.isConfirmed) {\r\n                handleDeleteUser(e);\r\n            } else {\r\n                Swal.fire({\r\n                    title: 'ยกเลิกการลบ',\r\n                    confirmButtonColor: '#64A2FF',\r\n                });\r\n            }\r\n        });\r\n    };\r\n    \r\n\r\n    if (loading) {\r\n        return <div className=\"loading\">Loading...</div>;\r\n    }\r\n\r\n    if (error) {\r\n        return <div className=\"error\">Error: {error}</div>;\r\n    }\r\n\r\n    return (\r\n        <div className='container'>\r\n            <div className=\"middle-box\">\r\n                <div className=\"search-container\">\r\n                    <input\r\n                        type=\"text\"\r\n                        className=\"search-input\"\r\n                        placeholder=\"ค้นหาด้วยชื่อ\"\r\n                        value={searchQuery}\r\n                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                    />\r\n                    <button className=\"blue-button\" onClick={handleAddNewUser}>เพิ่มผู้ใช้ใหม่</button>\r\n                </div>\r\n                <UserTable data={filteredData} roleOptions={roleOptions} onEdit={handleEditUser} handleClickConfirm={handleClickConfirm} />\r\n            </div>\r\n            {showEditUser && (\r\n                <EditUser\r\n                    isEditing={isEditing}\r\n                    user={userToEdit}\r\n                    onClose={() => setShowEditUser(false)}\r\n                    onSave={handleSaveUser}\r\n                />\r\n            )}\r\n            \r\n        </div>\r\n    );\r\n};\r\n\r\nexport default UserManager;\r\n"
        }
    ]
}